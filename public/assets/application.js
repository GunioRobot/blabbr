<<<<<<< HEAD
(function(b){b.Autocompleter=function(e,d){this.cacheData_={};this.cacheLength_=0;this.selectClass_="jquery-autocomplete-selected-item";this.lastSelectedValue_=this.lastProcessedValue_=this.lastKeyPressed_=this.keyTimeout_=null;this.active_=false;this.finishOnBlur_=true;if(!e||!(e instanceof jQuery)||e.length!==1||e.get(0).tagName.toUpperCase()!=="INPUT")alert("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected");else{this.options=typeof d==="string"?
{url:d}:d;this.options.maxCacheLength=parseInt(this.options.maxCacheLength);if(isNaN(this.options.maxCacheLength)||this.options.maxCacheLength<1)this.options.maxCacheLength=1;this.options.minChars=parseInt(this.options.minChars);if(isNaN(this.options.minChars)||this.options.minChars<1)this.options.minChars=1;this.dom={};this.dom.$elem=e;this.options.inputClass&&this.dom.$elem.addClass(this.options.inputClass);this.dom.$results=b("<div></div>").hide();this.options.resultsClass&&this.dom.$results.addClass(this.options.resultsClass);
this.dom.$results.css({position:"absolute"});b("body").append(this.dom.$results);var f=this;this.position();b(window).resize(function(){f.position()});e.keydown(function(h){f.lastKeyPressed_=h.keyCode;switch(f.lastKeyPressed_){case 38:h.preventDefault();f.active_?f.focusPrev():f.activate();return false;case 40:h.preventDefault();f.active_?f.focusNext():f.activate();return false;case 9:case 13:if(f.active_){h.preventDefault();f.selectCurrent();return false}break;case 27:if(f.active_){h.preventDefault();
f.finish();return false}break;default:f.activate()}});e.blur(function(){f.finishOnBlur_&&setTimeout(function(){f.finish()},200)})}};b.Autocompleter.prototype.position=function(){var e=this.dom.$elem.offset();this.dom.$results.css({top:e.top+this.dom.$elem.outerHeight(),left:e.left})};b.Autocompleter.prototype.cacheRead=function(e){var d,f,h,l,j;if(this.options.useCache){e=String(e);d=e.length;for(f=this.options.matchSubset?1:d;f<=d;){l=this.options.matchInside?d-f:0;for(j=0;j<=l;){h=e.substr(0,f);
if(this.cacheData_[h]!==undefined)return this.cacheData_[h];j++}f++}}return false};b.Autocompleter.prototype.cacheWrite=function(e,d){if(this.options.useCache){this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush();e=String(e);this.cacheData_[e]!==undefined&&this.cacheLength_++;return this.cacheData_[e]=d}return false};b.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};b.Autocompleter.prototype.callHook=function(e,d){var f=this.options[e];if(f&&b.isFunction(f))return f(d,
this);return false};b.Autocompleter.prototype.activate=function(){var e=this,d=parseInt(this.options.delay);if(isNaN(d)||d<=0)d=250;this.keyTimeout_&&clearTimeout(this.keyTimeout_);this.keyTimeout_=setTimeout(function(){e.activateNow()},d)};b.Autocompleter.prototype.activateNow=function(){var e=this.dom.$elem.val();if(e!==this.lastProcessedValue_&&e!==this.lastSelectedValue_)if(e.length>=this.options.minChars){this.active_=true;this.lastProcessedValue_=e;this.fetchData(e)}};b.Autocompleter.prototype.fetchData=
function(e){if(this.options.data)this.filterAndShowResults(this.options.data,e);else{var d=this;this.fetchRemoteData(e,function(f){d.filterAndShowResults(f,e)})}};b.Autocompleter.prototype.fetchRemoteData=function(e,d){var f=this.cacheRead(e);if(f)d(f);else try{var h=this;this.dom.$elem.addClass(this.options.loadingClass);b.get(this.makeUrl(e),function(j){j=h.parseRemoteData(j);h.cacheWrite(e,j);h.dom.$elem.removeClass(h.options.loadingClass);d(j)})}catch(l){this.dom.$elem.removeClass(this.options.loadingClass);
d(false)}};b.Autocompleter.prototype.setExtraParam=function(e,d){var f=b.trim(String(e));if(f){if(!this.options.extraParams)this.options.extraParams={};if(this.options.extraParams[f]!==d){this.options.extraParams[f]=d;this.cacheFlush()}}};b.Autocompleter.prototype.makeUrl=function(e){var d=this,f=this.options.paramName||"q",h=this.options.url,l=b.extend({},this.options.extraParams),j=[];l[f]=e;b.each(l,function(m,n){j.push(d.makeUrlParam(m,n))});h+=h.indexOf("?")==-1?"?":"&";h+=j.join("&");return h};
b.Autocompleter.prototype.makeUrlParam=function(e,d){return String(e)+"="+encodeURIComponent(d)};b.Autocompleter.prototype.parseRemoteData=function(e){var d=[],f,h,l,j=String(e).replace("\r\n","\n").split("\n");for(e=0;e<j.length;e++){l=j[e].split("|");h=[];for(f=0;f<l.length;f++)h.push(unescape(l[f]));f=h.shift();d.push({value:unescape(f),data:h})}return d};b.Autocompleter.prototype.filterAndShowResults=function(e,d){this.showResults(this.filterResults(e,d),d)};b.Autocompleter.prototype.filterResults=
function(e,d){var f=[],h,l,j,m,n,q="";for(j=0;j<e.length;j++){m=e[j];n=typeof m;if(n==="string"){h=m;l={}}else if(b.isArray(m)){h=m.shift();l=m}else if(n==="object"){h=m.value;l=m.data}if(h=String(h)){if(typeof l!=="object")l={};m=String(d);this.options.matchInside||(m="^"+m);this.options.matchCase||(q="i");m=RegExp(m,q);m.test(h)&&f.push({value:h,data:l})}}if(this.options.sortResults)return this.sortResults(f);return f};b.Autocompleter.prototype.sortResults=function(e){var d=this;b.isFunction(this.options.sortFunction)?
e.sort(this.options.sortFunction):e.sort(function(f,h){return d.sortValueAlpha(f,h)});return e};b.Autocompleter.prototype.sortValueAlpha=function(e,d){e=String(e.value);d=String(d.value);if(!this.options.matchCase){e=e.toLowerCase();d=d.toLowerCase()}if(e>d)return 1;if(e<d)return-1;return 0};b.Autocompleter.prototype.showResults=function(e,d){var f=this,h=b("<ul></ul>"),l,j,m,n=false,q=false,u=e.length;for(l=0;l<u;l++){j=e[l];m=b("<li>"+this.showResult(j.value,j.data)+"</li>");m.data("value",j.value);
m.data("data",j.data);m.click(function(){var t=b(this);f.selectItem(t)}).mousedown(function(){f.finishOnBlur_=false}).mouseup(function(){f.finishOnBlur_=true});h.append(m);if(n===false){n=String(j.value);q=m;m.addClass(this.options.firstItemClass)}l==u-1&&m.addClass(this.options.lastItemClass)}this.dom.$results.html(h).show();h=this.dom.$results.outerWidth()-this.dom.$results.width();this.dom.$results.width(this.dom.$elem.outerWidth()-h);b("li",this.dom.$results).hover(function(){f.focusItem(this)},
function(){});this.autoFill(n,d)&&this.focusItem(q)};b.Autocompleter.prototype.showResult=function(e,d){return b.isFunction(this.options.showResult)?this.options.showResult(e,d):e};b.Autocompleter.prototype.autoFill=function(e,d){var f,h,l,j;if(this.options.autoFill&&this.lastKeyPressed_!=8){f=String(e).toLowerCase();h=String(d).toLowerCase();l=e.length;j=d.length;if(f.substr(0,j)===h){this.dom.$elem.val(e);this.selectRange(j,l);return true}}return false};b.Autocompleter.prototype.focusNext=function(){this.focusMove(+1)};
b.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)};b.Autocompleter.prototype.focusMove=function(e){var d,f=b("li",this.dom.$results);e=parseInt(e);for(d=0;d<f.length;d++)if(b(f[d]).hasClass(this.selectClass_)){this.focusItem(d+e);return}this.focusItem(0)};b.Autocompleter.prototype.focusItem=function(e){var d=b("li",this.dom.$results);if(d.length){d.removeClass(this.selectClass_).removeClass(this.options.selectClass);if(typeof e==="number"){e=parseInt(e);if(e<0)e=0;else if(e>=d.length)e=
d.length-1;e=b(d[e])}else e=b(e);e&&e.addClass(this.selectClass_).addClass(this.options.selectClass)}};b.Autocompleter.prototype.selectCurrent=function(){var e=b("li."+this.selectClass_,this.dom.$results);e.length==1?this.selectItem(e):this.finish()};b.Autocompleter.prototype.selectItem=function(e){var d=e.data("value");e=e.data("data");var f=this.displayValue(d,e);this.lastSelectedValue_=this.lastProcessedValue_=f;this.dom.$elem.val(f).focus();this.setCaret(f.length);this.callHook("onItemSelect",
{value:d,data:e});this.finish()};b.Autocompleter.prototype.displayValue=function(e,d){return b.isFunction(this.options.displayValue)?this.options.displayValue(e,d):e};b.Autocompleter.prototype.finish=function(){this.keyTimeout_&&clearTimeout(this.keyTimeout_);if(this.dom.$elem.val()!==this.lastSelectedValue_){this.options.mustMatch&&this.dom.$elem.val("");this.callHook("onNoMatch")}this.dom.$results.hide();this.lastProcessedValue_=this.lastKeyPressed_=null;this.active_&&this.callHook("onFinish");
this.active_=false};b.Autocompleter.prototype.selectRange=function(e,d){var f=this.dom.$elem.get(0);if(f.setSelectionRange){f.focus();f.setSelectionRange(e,d)}else if(this.createTextRange){f=this.createTextRange();f.collapse(true);f.moveEnd("character",d);f.moveStart("character",e);f.select()}};b.Autocompleter.prototype.setCaret=function(e){this.selectRange(e,e)};b.fn.autocomplete=function(e){if(typeof e==="string")e={url:e};var d=b.extend({},b.fn.autocomplete.defaults,e);return this.each(function(){var f=
b(this),h=new b.Autocompleter(f,d);f.data("autocompleter",h)})};b.fn.autocomplete.defaults={minChars:1,loadingClass:"acLoading",resultsClass:"acResults",inputClass:"acInput",selectClass:"acSelect",mustMatch:false,matchCase:false,matchInside:true,matchSubset:true,useCache:true,maxCacheLength:10,autoFill:false,sortResults:true,sortFunction:false,onItemSelect:false,onNoMatch:false}})(jQuery);
(function(b){b.gritter={};b.gritter.options={fade_in_speed:"medium",fade_out_speed:1E3,time:6E3};b.gritter.add=function(d){try{return e.add(d||{})}catch(f){var h="Gritter Error: "+f;typeof console!="undefined"&&console.error?console.error(h,d):alert(h)}};b.gritter.remove=function(d,f){e.removeSpecific(d,f||{})};b.gritter.removeAll=function(d){e.stop(d||{})};var e={fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[image]]<div class="[[class_name]]"><span class="gritter-title">[[username]]</span><p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',
_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(d){if(!d.title||!d.text)throw'You need to fill out the first 2 params: "title" and "text"';this._is_setup||this._runSetup();var f=d.title,h=d.text,l=d.image||"",j=d.sticky||false,m=d.class_name||"",n=d.time||"";this._verifyWrapper();this._item_count++;var q=this._item_count,u=this._tpl_item;b(["before_open","after_open","before_close","after_close"]).each(function(t,x){e["_"+x+"_"+q]=b.isFunction(d[x])?d[x]:function(){}});this._custom_timer=
0;if(n)this._custom_timer=n;u=this._str_replace(["[[username]]","[[text]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[f,h,l!=""?'<img src="'+l+'" class="gritter-image" />':"",this._item_count,l!=""?"gritter-with-image":"gritter-without-image",m],u);this["_before_open_"+q]();b("#gritter-notice-wrapper").append(u);f=b("#gritter-item-"+this._item_count);f.fadeIn(this.fade_in_speed,function(){e["_after_open_"+q](b(this))});j||this._setFadeTimer(f,q);b(f).bind("mouseenter mouseleave",
function(t){if(t.type=="mouseenter")j||e._restoreItemIfFading(b(this),q);else j||e._setFadeTimer(b(this),q);e._hoverState(b(this),t.type)});return q},_countRemoveWrapper:function(d,f){f.remove();this["_after_close_"+d](f);b(".gritter-item-wrapper").length==0&&b("#gritter-notice-wrapper").remove()},_fade:function(d,f,h,l){h=h||{};var j=typeof h.fade!="undefined"?h.fade:true;fade_out_speed=h.speed||this.fade_out_speed;this["_before_close_"+f](d);l&&d.unbind("mouseenter mouseleave");j?d.animate({opacity:0},
fade_out_speed,function(){d.animate({height:0},300,function(){e._countRemoveWrapper(f,d)})}):this._countRemoveWrapper(f,d)},_hoverState:function(d,f){if(f=="mouseenter"){d.addClass("hover");var h=d.find("img");h.length?h.before(this._tpl_close):d.find("span").before(this._tpl_close);d.find(".gritter-close").click(function(){var l=d.attr("id").split("-")[2];e.removeSpecific(l,{},d,true)})}else{d.removeClass("hover");d.find(".gritter-close").remove()}},removeSpecific:function(d,f,h,l){h||(h=b("#gritter-item-"+
d));this._fade(h,d,f||{},l)},_restoreItemIfFading:function(d,f){clearTimeout(this["_int_id_"+f]);d.stop().css({opacity:""})},_runSetup:function(){for(opt in b.gritter.options)this[opt]=b.gritter.options[opt];this._is_setup=1},_setFadeTimer:function(d,f){this["_int_id_"+f]=setTimeout(function(){e._fade(d,f)},this._custom_timer?this._custom_timer:this.time)},stop:function(d){var f=b.isFunction(d.before_close)?d.before_close:function(){},h=b.isFunction(d.after_close)?d.after_close:function(){};d=b("#gritter-notice-wrapper");
f(d);d.fadeOut(function(){b(this).remove();h()})},_str_replace:function(d,f,h,l){var j=0,m=0,n="",q="",u=0,t=0;d=[].concat(d);f=[].concat(f);h=h;var x=f instanceof Array,a=h instanceof Array;h=[].concat(h);if(l)this.window[l]=0;j=0;for(u=h.length;j<u;j++)if(h[j]!==""){m=0;for(t=d.length;m<t;m++){n=h[j]+"";q=x?f[m]!==undefined?f[m]:"":f[0];h[j]=n.split(d[m]).join(q);if(l&&h[j]!==n)this.window[l]+=(n.length-h[j].length)/d[m].length}}return a?h:h[0]},_verifyWrapper:function(){b("#gritter-notice-wrapper").length==
0&&b("body").append(this._tpl_wrap)}}})(jQuery);
(function(b){b.extend(b.fn,{livequery:function(e,d,f){var h=this,l;if(b.isFunction(e)){f=d;d=e;e=undefined}b.each(b.livequery.queries,function(j,m){if(h.selector==m.selector&&h.context==m.context&&e==m.type&&(!d||d.$lqguid==m.fn.$lqguid)&&(!f||f.$lqguid==m.fn2.$lqguid))return(l=m)&&false});l=l||new b.livequery(this.selector,this.context,e,d,f);l.stopped=false;l.run();return this},expire:function(e,d,f){var h=this;if(b.isFunction(e)){f=d;d=e;e=undefined}b.each(b.livequery.queries,function(l,j){if(h.selector==
j.selector&&h.context==j.context&&(!e||e==j.type)&&(!d||d.$lqguid==j.fn.$lqguid)&&(!f||f.$lqguid==j.fn2.$lqguid)&&!this.stopped)b.livequery.stop(j.id)});return this}});b.livequery=function(e,d,f,h,l){this.selector=e;this.context=d;this.type=f;this.fn=h;this.fn2=l;this.elements=[];this.stopped=false;this.id=b.livequery.queries.push(this)-1;h.$lqguid=h.$lqguid||b.livequery.guid++;if(l)l.$lqguid=l.$lqguid||b.livequery.guid++;return this};b.livequery.prototype={stop:function(){var e=this;if(this.type)this.elements.unbind(this.type,
this.fn);else this.fn2&&this.elements.each(function(d,f){e.fn2.apply(f)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var e=this,d=this.elements,f=b(this.selector,this.context),h=f.not(d);this.elements=f;if(this.type){h.bind(this.type,this.fn);d.length>0&&b.each(d,function(l,j){b.inArray(j,f)<0&&b.event.remove(j,e.type,e.fn)})}else{h.each(function(){e.fn.apply(this)});this.fn2&&d.length>0&&b.each(d,function(l,j){b.inArray(j,f)<0&&e.fn2.apply(j)})}}}};b.extend(b.livequery,
{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(b.livequery.running&&b.livequery.queue.length)for(var e=b.livequery.queue.length;e--;)b.livequery.queries[b.livequery.queue.shift()].run()},pause:function(){b.livequery.running=false},play:function(){b.livequery.running=true;b.livequery.run()},registerPlugin:function(){b.each(arguments,function(e,d){if(b.fn[d]){var f=b.fn[d];b.fn[d]=function(){var h=f.apply(this,arguments);b.livequery.run();return h}}})},run:function(e){if(e!=
undefined)b.inArray(e,b.livequery.queue)<0&&b.livequery.queue.push(e);else b.each(b.livequery.queries,function(d){b.inArray(d,b.livequery.queue)<0&&b.livequery.queue.push(d)});b.livequery.timeout&&clearTimeout(b.livequery.timeout);b.livequery.timeout=setTimeout(b.livequery.checkQueue,20)},stop:function(e){e!=undefined?b.livequery.queries[e].stop():b.each(b.livequery.queries,function(d){b.livequery.queries[d].stop()})}});b.livequery.registerPlugin("append","prepend","after","before","wrap","attr",
"removeAttr","addClass","removeClass","toggleClass","empty","remove","html");b(function(){b.livequery.play()})})(jQuery);
(function(b){b.fn.sexyPost=function(e){var d=["onstart","onprogress","oncomplete","onerror","onabort","onfilestart","onfilecomplete"],f={async:true,autoclear:false,onstart:function(){},onprogress:function(){},oncomplete:function(){},onerror:function(){},onabort:function(){}};e&&b.extend(f,e);this.each(function(){function h(m,n,q,u){var t=new FormData;b("input:text, input:hidden, input:password, textarea",m).each(function(){t.append(b(this).attr("name"),b(this).val())});b("input:file",m).each(function(){var x=
this.files;for(i=0;i<x.length;i++)t.append(b(this).attr("name"),x[i])});b("select option:selected",m).each(function(){t.append(b(this).parent().attr("name"),b(this).val())});b("input:checked",m).each(function(){t.append(b(this).attr("name"),b(this).val())});j.open(q,n,u);j.setRequestHeader("Cache-Control","no-cache");j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.send(t)}for(event in d)f[d[event]]&&b(this).bind("sexyPost."+d[event],f[d[event]]);var l=b(this);l.submit(function(){var m=b(this).attr("action"),
n=b(this).attr("method");h(this,m,n,f.async);return false});b(".submit-trigger",l).not(":button").bind("change",function(){l.trigger("submit")});b(".submit-trigger",l).not(":input").bind("click",function(){l.trigger("submit")});var j=new XMLHttpRequest;j.onloadstart=function(){l.trigger("sexyPost.onstart")};j.onload=function(){f.autoclear&&j.status>=200&&j.status<=204&&b(":input",l).not(":button, :submit, :reset, :hidden").removeAttr("checked").removeAttr("selected").val("");l.trigger("sexyPost.oncomplete",
[j.responseText])};j.onerror=function(){l.trigger("sexyPost.onerror")};j.onabort=function(){l.trigger("sexyPost.onabort")};j.upload.onprogress=function(m){l.trigger("sexyPost.onprogress",[m.loaded/m.total,m.loaded,m.total])}});return this}})(jQuery);
(function(b,e){var d,f=/:([\w\d]+)/g,h=/\?([^#]*)$/,l=function(a){return Array.prototype.slice.call(a)},j=function(a){return Object.prototype.toString.call(a)==="[object Function]"},m=function(a){return Object.prototype.toString.call(a)==="[object Array]"},n=decodeURIComponent,q=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},u=function(a){return function(c,g){return this.route.apply(this,[a,c,g])}},t={},x=[];d=function(){var a=l(arguments),c,g;d.apps=d.apps||
{};if(a.length===0||a[0]&&j(a[0]))return d.apply(d,["body"].concat(a));else if(typeof(g=a.shift())=="string"){c=d.apps[g]||new d.Application;c.element_selector=g;a.length>0&&b.each(a,function(k,p){c.use(p)});c.element_selector!=g&&delete d.apps[g];return d.apps[c.element_selector]=c}};d.VERSION="0.6.2";d.addLogger=function(a){x.push(a)};d.log=function(){var a=l(arguments);a.unshift("["+Date()+"]");b.each(x,function(c,g){g.apply(d,a)})};if(typeof e.console!="undefined")j(console.log.apply)?d.addLogger(function(){e.console.log.apply(console,
arguments)}):d.addLogger(function(){e.console.log(arguments)});else typeof console!="undefined"&&d.addLogger(function(){console.log.apply(console,arguments)});b.extend(d,{makeArray:l,isFunction:j,isArray:m});d.Object=function(a){return b.extend(this,a||{})};b.extend(d.Object.prototype,{escapeHTML:q,h:q,toHash:function(){var a={};b.each(this,function(c,g){j(g)||(a[c]=g)});return a},toHTML:function(){var a="";b.each(this,function(c,g){j(g)||(a+="<strong>"+c+"</strong> "+g+"<br />")});return a},keys:function(a){var c=
[],g;for(g in this)if(!j(this[g])||!a)c.push(g);return c},has:function(a){return this[a]&&b.trim(this[a].toString())!=""},join:function(){var a=l(arguments),c=a.shift();return a.join(c)},log:function(){d.log.apply(d,arguments)},toString:function(a){var c=[];b.each(this,function(g,k){if(!j(k)||a)c.push('"'+g+'": '+k.toString())});return"Sammy.Object: {"+c.join(",")+"}"}});d.HashLocationProxy=function(a,c){this.app=a;this.is_native=false;this._startPolling(c)};d.HashLocationProxy.prototype={bind:function(){var a=
this,c=this.app;b(e).bind("hashchange."+this.app.eventNamespace(),function(g,k){if(a.is_native===false&&!k){d.log("native hash change exists, using");a.is_native=true;e.clearInterval(d.HashLocationProxy._interval)}c.trigger("location-changed")});if(!d.HashLocationProxy._bindings)d.HashLocationProxy._bindings=0;d.HashLocationProxy._bindings++},unbind:function(){b(e).unbind("hashchange."+this.app.eventNamespace());d.HashLocationProxy._bindings--;d.HashLocationProxy._bindings<=0&&e.clearInterval(d.HashLocationProxy._interval)},
getLocation:function(){var a=e.location.toString().match(/^[^#]*(#.+)$/);return a?a[1]:""},setLocation:function(a){return e.location=a},_startPolling:function(a){var c=this;if(!d.HashLocationProxy._interval){a||(a=10);var g=function(){var k=c.getLocation();if(!d.HashLocationProxy._last_location||k!=d.HashLocationProxy._last_location)e.setTimeout(function(){b(e).trigger("hashchange",[true])},13);d.HashLocationProxy._last_location=k};g();d.HashLocationProxy._interval=e.setInterval(g,a)}}};d.Application=
function(a){var c=this;this.routes={};this.listeners=new d.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1E3,10);this.context_prototype=function(){d.EventContext.apply(this,arguments)};this.context_prototype.prototype=new d.EventContext;j(a)&&a.apply(this,[this]);this._location_proxy||this.setLocationProxy(new d.HashLocationProxy(this,this.run_interval_every));this.debug&&this.bindToAllEvents(function(g,k){c.log(c.toString(),g.cleaned_type,
k||{})})};d.Application.prototype=b.extend({},d.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:false,element_selector:"body",debug:false,raise_errors:false,run_interval_every:50,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},
$element:function(){return b(this.element_selector)},use:function(){var a=l(arguments),c=a.shift(),g=c||"";try{a.unshift(this);if(typeof c=="string"){g="Sammy."+c;c=d[c]}c.apply(this,a)}catch(k){if(typeof c==="undefined")this.error("Plugin Error: called use() but plugin ("+g.toString()+") is not defined",k);else j(c)?this.error("Plugin Error",k):this.error("Plugin Error: called use() but '"+g.toString()+"' is not a function",k)}return this},setLocationProxy:function(a){var c=this._location_proxy;
this._location_proxy=a;if(this.isRunning()){c&&c.unbind();this._location_proxy.bind()}},route:function(a,c,g){var k=this,p=[],o,r;if(!g&&j(c)){g=c=a;a="any"}a=a.toLowerCase();if(c.constructor==String){for(f.lastIndex=0;(r=f.exec(c))!==null;)p.push(r[1]);c=RegExp("^"+c.replace(f,"([^/]+)")+"$")}if(typeof g=="string")g=k[g];o=function(s){var v={verb:s,path:c,callback:g,param_names:p};k.routes[s]=k.routes[s]||[];k.routes[s].push(v)};a==="any"?b.each(this.ROUTE_VERBS,function(s,v){o(v)}):o(a);return this},
get:u("get"),post:u("post"),put:u("put"),del:u("delete"),any:u("any"),mapRoutes:function(a){var c=this;b.each(a,function(g,k){c.route.apply(c,k)});return this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(a,c,g){var k=this;if(typeof g=="undefined")g=c;c=function(p,o){var r;if(o&&o.context){r=o.context;delete o.context}else r=new k.context_prototype(k,"bind",p.type,o,p.target);p.cleaned_type=p.type.replace(k.eventNamespace(),"");g.apply(r,[p,o])};this.listeners[a]||
(this.listeners[a]=[]);this.listeners[a].push(c);this.isRunning()&&this._listen(a,c);return this},trigger:function(a,c){this.$element().trigger([a,this.eventNamespace()].join("."),[c]);return this},refresh:function(){this.last_location=null;this.trigger("location-changed");return this},before:function(a,c){if(j(a)){c=a;a={}}this.befores.push([a,c]);return this},after:function(a){return this.bind("event-context-after",a)},around:function(a){this.arounds.push(a);return this},isRunning:function(){return this._running},
helpers:function(a){b.extend(this.context_prototype.prototype,a);return this},helper:function(a,c){this.context_prototype.prototype[a]=c;return this},run:function(a){if(this.isRunning())return false;var c=this;b.each(this.listeners.toHash(),function(g,k){b.each(k,function(p,o){c._listen(g,o)})});this.trigger("run",{start_url:a});this._running=true;this.last_location=null;this.getLocation()==""&&typeof a!="undefined"&&this.setLocation(a);this._checkLocation();this._location_proxy.bind();this.bind("location-changed",
function(){c._checkLocation()});this.bind("submit",function(g){return c._checkFormSubmission(b(g.target).closest("form"))===false?g.preventDefault():false});b(e).bind("beforeunload",function(){c.unload()});return this.trigger("changed")},unload:function(){if(!this.isRunning())return false;var a=this;this.trigger("unload");this._location_proxy.unbind();this.$element().unbind("submit").removeClass(a.eventNamespace());b.each(this.listeners.toHash(),function(c,g){b.each(g,function(k,p){a._unlisten(c,
p)})});this._running=false;return this},bindToAllEvents:function(a){var c=this;b.each(this.APP_EVENTS,function(g,k){c.bind(k,a)});b.each(this.listeners.keys(true),function(g,k){c.APP_EVENTS.indexOf(k)==-1&&c.bind(k,a)});return this},routablePath:function(a){return a.replace(h,"")},lookupRoute:function(a,c){var g=this,k=false;this.trigger("lookup-route",{verb:a,path:c});typeof this.routes[a]!="undefined"&&b.each(this.routes[a],function(p,o){if(g.routablePath(c).match(o.path)){k=o;return false}});return k},
runRoute:function(a,c,g,k){var p=this,o=this.lookupRoute(a,c),r,s,v,w,B,A,C;this.log("runRoute",[a,c].join(" "));this.trigger("run-route",{verb:a,path:c,params:g});if(typeof g=="undefined")g={};b.extend(g,this._parseQueryString(c));if(o){this.trigger("route-found",{route:o});if((A=o.path.exec(this.routablePath(c)))!==null){A.shift();b.each(A,function(y,z){if(o.param_names[y])g[o.param_names[y]]=n(z);else{if(!g.splat)g.splat=[];g.splat.push(n(z))}})}r=new this.context_prototype(this,a,c,g,k);k=this.arounds.slice(0);
v=this.befores.slice(0);B=[r].concat(g.splat);s=function(){for(var y;v.length>0;){w=v.shift();if(p.contextMatchesOptions(r,w[0])){y=w[1].apply(r,[r]);if(y===false)return false}}p.last_route=o;r.trigger("event-context-before",{context:r});y=o.callback.apply(r,B);r.trigger("event-context-after",{context:r});return y};b.each(k.reverse(),function(y,z){var D=s;s=function(){return z.apply(r,[D])}});try{C=s()}catch(E){this.error(["500 Error",a,c].join(" "),E)}return C}else return this.notFound(a,c)},contextMatchesOptions:function(a,
c,g){c=c;if(typeof c==="undefined"||c=={})return true;if(typeof g==="undefined")g=true;if(typeof c==="string"||j(c.test))c={path:c};if(c.only)return this.contextMatchesOptions(a,c.only,true);else if(c.except)return this.contextMatchesOptions(a,c.except,false);var k=true,p=true;if(c.path)k=j(c.path.test)?c.path.test(a.path):c.path.toString()===a.path;if(c.verb)p=c.verb===a.verb;return g?p&&k:!(p&&k)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(a){return this._location_proxy.setLocation(a)},
swap:function(a){return this.$element().html(a)},templateCache:function(a,c){return typeof c!="undefined"?t[a]=c:t[a]},clearTemplateCache:function(){return t={}},notFound:function(a,c){var g=this.error(["404 Not Found",a,c].join(" "));return a==="get"?g:true},error:function(a,c){c||(c=Error());c.message=[a,c.message].join(" ");this.trigger("error",{message:c.message,error:c});if(this.raise_errors)throw c;else this.log(c.message,c)},_checkLocation:function(){var a,c;a=this.getLocation();if(!this.last_location||
this.last_location[0]!="get"||this.last_location[1]!=a){this.last_location=["get",a];c=this.runRoute("get",a)}return c},_getFormVerb:function(a){a=b(a);var c,g;g=a.find('input[name="_method"]');if(g.length>0)c=g.val();c||(c=a[0].getAttribute("method"));return b.trim(c.toString().toLowerCase())},_checkFormSubmission:function(a){var c,g,k;this.trigger("check-form-submission",{form:a});c=b(a);g=c.attr("action");k=this._getFormVerb(c);if(!k||k=="")k="get";this.log("_checkFormSubmission",c,g,k);if(k===
"get"){this.setLocation(g+"?"+c.serialize());a=false}else{c=b.extend({},this._parseFormParams(c));a=this.runRoute(k,g,c,a.get(0))}return typeof a=="undefined"?false:a},_parseFormParams:function(a){var c={};a=a.serializeArray();var g;for(g=0;g<a.length;g++)c=this._parseParamPair(c,a[g].name,a[g].value);return c},_parseQueryString:function(a){var c={},g,k;if(a=a.match(h)){a=a[1].split("&");for(k=0;k<a.length;k++){g=a[k].split("=");c=this._parseParamPair(c,n(g[0]),n(g[1]))}}return c},_parseParamPair:function(a,
c,g){if(a[c])if(m(a[c]))a[c].push(g);else a[c]=[a[c],g];else a[c]=g;return a},_listen:function(a,c){return this.$element().bind([a,this.eventNamespace()].join("."),c)},_unlisten:function(a,c){return this.$element().unbind([a,this.eventNamespace()].join("."),c)}});d.RenderContext=function(a){this.event_context=a;this.callbacks=[];this.content=this.previous_content=null;this.waiting=this.next_engine=false};b.extend(d.RenderContext.prototype,{then:function(a){if(!j(a))if(typeof a==="string"&&a in this.event_context){var c=
this.event_context[a];a=function(k){return c.apply(this.event_context,[k])}}else return this;var g=this;if(this.waiting)this.callbacks.push(a);else{this.wait();e.setTimeout(function(){var k=a.apply(g,[g.content,g.previous_content]);k!==false&&g.next(k)},13)}return this},wait:function(){this.waiting=true},next:function(a){this.waiting=false;if(typeof a!=="undefined"){this.previous_content=this.content;this.content=a}this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(a,c,g){var k=
this;return this.then(function(){var p,o,r;if(j(c)){g=c;c={}}else c=b.extend({},c);g&&this.then(g);if(typeof a==="string"){p=(r=a.match(/\.json$/)||c.json)&&c.cache===true||c.cache!==false;k.next_engine=k.event_context.engineFor(a);delete c.cache;delete c.json;if(c.engine){k.next_engine=c.engine;delete c.engine}if(p&&(o=this.event_context.app.templateCache(a)))return o;this.wait();b.ajax(b.extend({url:a,data:{},dataType:r?"json":null,type:"get",success:function(s){p&&k.event_context.app.templateCache(a,
s);k.next(s)}},c));return false}else{if(a.nodeType)return a.innerHTML;if(a.selector){k.next_engine=a.attr("data-engine");return c.clone===false?a.remove()[0].innerHTML.toString():a[0].innerHTML.toString()}}})},render:function(a,c,g){if(j(a)&&!c)return this.then(a);else{if(!c&&this.content)c=this.content;return this.load(a).interpolate(c,a).then(g)}},partial:function(a,c){return this.render(a,c).swap()},send:function(){var a=this,c=l(arguments),g=c.shift();if(m(c[0]))c=c[0];return this.then(function(){c.push(function(k){a.next(k)});
a.wait();g.apply(g,c);return false})},collect:function(a,c,g){var k=this,p=function(){if(j(a)){c=a;a=this.content}var o=[],r=false;b.each(a,function(s,v){var w=c.apply(k,[s,v]);if(w.jquery&&w.length==1){w=w[0];r=true}o.push(w);return w});return r?o:o.join("")};return g?p():this.then(p)},renderEach:function(a,c,g,k){if(m(c)){k=g;g=c;c=null}return this.load(a).then(function(p){var o=this;g||(g=m(this.previous_content)?this.previous_content:[]);if(k)b.each(g,function(r,s){var v={},w=this.next_engine||
a;c?v[c]=s:v=s;k(s,o.event_context.interpolate(p,v,w))});else return this.collect(g,function(r,s){var v={},w=this.next_engine||a;c?v[c]=s:v=s;return this.event_context.interpolate(p,v,w)},true)})},interpolate:function(a,c,g){var k=this;return this.then(function(p,o){if(!a&&o)a=o;if(this.next_engine){c=this.next_engine;this.next_engine=false}var r=k.event_context.interpolate(p,a,c);return g?o+r:r})},swap:function(){return this.then(function(a){this.event_context.swap(a)}).trigger("changed",{})},appendTo:function(a){return this.then(function(c){b(a).append(c)}).trigger("changed",
{})},prependTo:function(a){return this.then(function(c){b(a).prepend(c)}).trigger("changed",{})},replace:function(a){return this.then(function(c){b(a).html(c)}).trigger("changed",{})},trigger:function(a,c){return this.then(function(g){if(typeof c=="undefined")c={content:g};this.event_context.trigger(a,c)})}});d.EventContext=function(a,c,g,k,p){this.app=a;this.verb=c;this.path=g;this.params=new d.Object(k);this.target=p};d.EventContext.prototype=b.extend({},d.Object.prototype,{$element:function(){return this.app.$element()},
engineFor:function(a){var c;if(j(a))return a;a=a.toString();if(c=a.match(/\.([^\.]+)$/))a=c[1];if(a&&j(this[a]))return this[a];if(this.app.template_engine)return this.engineFor(this.app.template_engine);return function(g){return g}},interpolate:function(a,c,g){return this.engineFor(g).apply(this,[a,c])},render:function(a,c,g){return(new d.RenderContext(this)).render(a,c,g)},renderEach:function(a,c,g,k){return(new d.RenderContext(this)).renderEach(a,c,g,k)},load:function(a,c,g){return(new d.RenderContext(this)).load(a,
c,g)},partial:function(a,c){return(new d.RenderContext(this)).partial(a,c)},send:function(){var a=new d.RenderContext(this);return a.send.apply(a,arguments)},redirect:function(){var a;a=l(arguments);var c=this.app.getLocation();if(a.length>1){a.unshift("/");a=this.join.apply(this,a)}else a=a[0];this.trigger("redirect",{to:a});this.app.last_location=[this.verb,this.path];this.app.setLocation(a);c==a&&this.app.trigger("location-changed")},trigger:function(a,c){if(typeof c=="undefined")c={};if(!c.context)c.context=
this;return this.app.trigger(a,c)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(a){return this.app.swap(a)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(a){return b.parseJSON(a)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}});b.sammy=e.Sammy=d})(jQuery,window);var root=history.pushState?"/":"#/";
(function(b){Sammy=Sammy||{};Sammy.PushLocationProxy=function(e){this.app=e};Sammy.PushLocationProxy.prototype={bind:function(){var e=this;b(window).bind("popstate",function(){e.app.trigger("location-changed")});b("a").live("click",function(d){if(location.hostname==this.hostname){d.preventDefault();e.setLocation(b(this).attr("href"));e.app.trigger("location-changed")}})},unbind:function(){b("a").unbind("click");b(window).unbind("popstate")},getLocation:function(){return window.location.pathname},
setLocation:function(e){history.pushState({path:this.path},"",e)}}})(jQuery);
(function(b){function e(m,n){b.ajax({type:"GET",url:m,dataType:"html",success:function(q){if(q){showContent(q,n);setTitle(b(".page-title").attr("title"));window.location.hash&&goToByScroll(window.location.hash)}}})}function d(m,n){b.ajax({type:"POST",url:m,dataType:"html",data:b.param(n.toHash()),success:function(q){showContent(q,"#contents")}})}function f(m,n){b.ajax({type:"POST",url:m,dataType:"html",data:b.param(n.toHash()),success:function(q){replaceContent(q,n.post_id)}})}function h(m,n){b.ajax({type:"POST",
url:m,dataType:"html",data:b.param(n.toHash()),success:function(q){addContent(q)}})}function l(m){pusher||(pusher=new Pusher(b("body").attr("id")));pusher.channels.channels[m]||pusher.subscribe(m).bind("new-post",function(n){showPost("/topics/"+m+"/posts/"+n.id+".js",n.user_id)})}var j=b.sammy(function(){this.notFound=function(m,n){document.location.href=n};history.pushState&&this.setLocationProxy(new Sammy.PushLocationProxy(this));this.before(function(){path=ajaxPath(this.path);loadingNotification()});
this.after(function(){if(typeof _gaq!=="undefined"){_gaq.push(["_trackPageview"]);_gaq.push(["_trackEvent",this.path,this.verb,"blabbr"])}});this.get(root,function(){e(path,"#contents")});this.get(root+"topics",function(){e(path,"aside")});this.get(root+"topics/new",function(){e(path,"aside")});this.post("/topics",function(){d(path,this.params)});this.get(root+"topics/page/:page_id",function(){e(path,"#contents")});this.get(root+"topics/:id",function(){l(this.params.id);e(path,"#contents")});this.get(root+
"topics/:id/edit",function(){e(path,"aside")});this.put("/topics/:id",function(){h(path,this.params);e(path,"#contents")});this.post("/topics/:id/posts",function(){h(path,this.params)});this.post("/topics/:id/members",function(){h(path,this.params)});this.get(root+"topics/:id/page/:page_id",function(){l(this.params.id);e(path,"#contents")});this.get(root+"topics/:id/page/:page_id/:anchor",function(){l(this.params.id);params=this.params;getAndScroll("/topics/"+params.id+"/page/"+params.page_id+".js",
"#contents",params.anchor)});this.get(root+"topics/:id/posts/:post_id/edit",function(){var m=this.params.post_id;b.get(path,function(n){n&&showEdit(n,m)})});this.put("/topics/:id/posts/:post_id",function(){f(path,this.params)});this.get(root+"users/:id",function(){e(path,"aside")});this.put("/users/:id",function(){d(path,this.params)});this.get(root+"dashboard",function(){e(path,"aside")});this.get(root+"smilies",function(){e(path)});this.get(root+"smilies/new",function(){e(path,"aside")})});b(function(){j.run(root)})})(jQuery);
var titleHolder=document.title;
jQuery(function(b){b("input.autocomplete").livequery(function(){b(this).each(function(){var e=b(this);e.autocomplete(e.attr("data-autocomplete-url"))})});b("#new_smiley").livequery(function(){b(this).sexyPost({onprogress:function(e,d){b("#status").text("Uploading: "+(d*100).toFixed(2)+"% complete...")},oncomplete:function(){b("#status").text("Upload complete.")}})});if(!history.pushState){console.log(history.pushState);b("a[href^=/][class!='no-ajax']").livequery(function(){var e=b(this).attr("href");
b(this).attr("href","#"+e.replace("#","/"))})}b(".simple_form.user").livequery(function(){b(this).sexyPost({onprogress:function(e,d){b("#status").text("Uploading: "+(d*100).toFixed(2)+"% complete...")},oncomplete:function(){b("#status").text("Upload complete.")}})});b("html").mouseover(function(){gainedFocus()});b(".bubble p, .bubble ul").live("click",function(e){if(b(e.target).is("p, ul")){e=b(this).parent().get(0).getAttribute("data_user");insertQuote(b(this).text(),e)}})});
function insertQuote(b,e){$("#post_body").val($("#post_body").val()+"bq..:"+e+" "+b+" \n\np. ")}function ajaxPath(b){return history.pushState?"/"+b.substr(1)+".js":b.substr(1)+".js"}function showPost(b,e){$.get(b,function(d){if(d){$(d).hide().appendTo("#posts").show("slow");e!=user_id&&notify();hideLoadingNotification()}},"js")}function showEdit(b,e){$("#"+e).find("div").html(b);hideLoadingNotification()}function showContent(b,e){$(e).html(b);hideLoadingNotification()}
function setTitle(b){$("#page-title").html(b);document.title="Blabbr - "+b}function replaceContent(b,e){$("#"+e+" .bubble").html(b);hideLoadingNotification()}function addContent(b){$("#contents").append(b);hideLoadingNotification()}function notify(){lostFocus();blinkTitle(1);user_audio&&audioNotification()}
=======
(function(b){b.Autocompleter=function(d,e){this.cacheData_={};this.cacheLength_=0;this.selectClass_="jquery-autocomplete-selected-item";this.lastSelectedValue_=this.lastProcessedValue_=this.lastKeyPressed_=this.keyTimeout_=null;this.active_=false;this.finishOnBlur_=true;if(!d||!(d instanceof jQuery)||d.length!==1||d.get(0).tagName.toUpperCase()!=="INPUT")alert("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected");else{this.options=typeof e==="string"?
{url:e}:e;this.options.maxCacheLength=parseInt(this.options.maxCacheLength);if(isNaN(this.options.maxCacheLength)||this.options.maxCacheLength<1)this.options.maxCacheLength=1;this.options.minChars=parseInt(this.options.minChars);if(isNaN(this.options.minChars)||this.options.minChars<1)this.options.minChars=1;this.dom={};this.dom.$elem=d;this.options.inputClass&&this.dom.$elem.addClass(this.options.inputClass);this.dom.$results=b("<div></div>").hide();this.options.resultsClass&&this.dom.$results.addClass(this.options.resultsClass);
this.dom.$results.css({position:"absolute"});b("body").append(this.dom.$results);var g=this;this.position();b(window).resize(function(){g.position()});d.keydown(function(k){g.lastKeyPressed_=k.keyCode;switch(g.lastKeyPressed_){case 38:k.preventDefault();g.active_?g.focusPrev():g.activate();return false;case 40:k.preventDefault();g.active_?g.focusNext():g.activate();return false;case 9:case 13:if(g.active_){k.preventDefault();g.selectCurrent();return false}break;case 27:if(g.active_){k.preventDefault();
g.finish();return false}break;default:g.activate()}});d.blur(function(){g.finishOnBlur_&&setTimeout(function(){g.finish()},200)})}};b.Autocompleter.prototype.position=function(){var d=this.dom.$elem.offset();this.dom.$results.css({top:d.top+this.dom.$elem.outerHeight(),left:d.left})};b.Autocompleter.prototype.cacheRead=function(d){var e,g,k,l,j;if(this.options.useCache){d=String(d);e=d.length;for(g=this.options.matchSubset?1:e;g<=e;){l=this.options.matchInside?e-g:0;for(j=0;j<=l;){k=d.substr(0,g);
if(this.cacheData_[k]!==undefined)return this.cacheData_[k];j++}g++}}return false};b.Autocompleter.prototype.cacheWrite=function(d,e){if(this.options.useCache){this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush();d=String(d);this.cacheData_[d]!==undefined&&this.cacheLength_++;return this.cacheData_[d]=e}return false};b.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};b.Autocompleter.prototype.callHook=function(d,e){var g=this.options[d];if(g&&b.isFunction(g))return g(e,
this);return false};b.Autocompleter.prototype.activate=function(){var d=this,e=parseInt(this.options.delay);if(isNaN(e)||e<=0)e=250;this.keyTimeout_&&clearTimeout(this.keyTimeout_);this.keyTimeout_=setTimeout(function(){d.activateNow()},e)};b.Autocompleter.prototype.activateNow=function(){var d=this.dom.$elem.val();if(d!==this.lastProcessedValue_&&d!==this.lastSelectedValue_)if(d.length>=this.options.minChars){this.active_=true;this.lastProcessedValue_=d;this.fetchData(d)}};b.Autocompleter.prototype.fetchData=
function(d){if(this.options.data)this.filterAndShowResults(this.options.data,d);else{var e=this;this.fetchRemoteData(d,function(g){e.filterAndShowResults(g,d)})}};b.Autocompleter.prototype.fetchRemoteData=function(d,e){var g=this.cacheRead(d);if(g)e(g);else try{var k=this;this.dom.$elem.addClass(this.options.loadingClass);b.get(this.makeUrl(d),function(j){j=k.parseRemoteData(j);k.cacheWrite(d,j);k.dom.$elem.removeClass(k.options.loadingClass);e(j)})}catch(l){this.dom.$elem.removeClass(this.options.loadingClass);
e(false)}};b.Autocompleter.prototype.setExtraParam=function(d,e){var g=b.trim(String(d));if(g){if(!this.options.extraParams)this.options.extraParams={};if(this.options.extraParams[g]!==e){this.options.extraParams[g]=e;this.cacheFlush()}}};b.Autocompleter.prototype.makeUrl=function(d){var e=this,g=this.options.paramName||"q",k=this.options.url,l=b.extend({},this.options.extraParams),j=[];l[g]=d;b.each(l,function(m,r){j.push(e.makeUrlParam(m,r))});k+=k.indexOf("?")==-1?"?":"&";k+=j.join("&");return k};
b.Autocompleter.prototype.makeUrlParam=function(d,e){return String(d)+"="+encodeURIComponent(e)};b.Autocompleter.prototype.parseRemoteData=function(d){var e=[],g,k,l,j=String(d).replace("\r\n","\n").split("\n");for(d=0;d<j.length;d++){l=j[d].split("|");k=[];for(g=0;g<l.length;g++)k.push(unescape(l[g]));g=k.shift();e.push({value:unescape(g),data:k})}return e};b.Autocompleter.prototype.filterAndShowResults=function(d,e){this.showResults(this.filterResults(d,e),e)};b.Autocompleter.prototype.filterResults=
function(d,e){var g=[],k,l,j,m,r,v="";for(j=0;j<d.length;j++){m=d[j];r=typeof m;if(r==="string"){k=m;l={}}else if(b.isArray(m)){k=m.shift();l=m}else if(r==="object"){k=m.value;l=m.data}if(k=String(k)){if(typeof l!=="object")l={};m=String(e);this.options.matchInside||(m="^"+m);this.options.matchCase||(v="i");m=RegExp(m,v);m.test(k)&&g.push({value:k,data:l})}}if(this.options.sortResults)return this.sortResults(g);return g};b.Autocompleter.prototype.sortResults=function(d){var e=this;b.isFunction(this.options.sortFunction)?
d.sort(this.options.sortFunction):d.sort(function(g,k){return e.sortValueAlpha(g,k)});return d};b.Autocompleter.prototype.sortValueAlpha=function(d,e){d=String(d.value);e=String(e.value);if(!this.options.matchCase){d=d.toLowerCase();e=e.toLowerCase()}if(d>e)return 1;if(d<e)return-1;return 0};b.Autocompleter.prototype.showResults=function(d,e){var g=this,k=b("<ul></ul>"),l,j,m,r=false,v=false,w=d.length;for(l=0;l<w;l++){j=d[l];m=b("<li>"+this.showResult(j.value,j.data)+"</li>");m.data("value",j.value);
m.data("data",j.data);m.click(function(){var u=b(this);g.selectItem(u)}).mousedown(function(){g.finishOnBlur_=false}).mouseup(function(){g.finishOnBlur_=true});k.append(m);if(r===false){r=String(j.value);v=m;m.addClass(this.options.firstItemClass)}l==w-1&&m.addClass(this.options.lastItemClass)}this.dom.$results.html(k).show();k=this.dom.$results.outerWidth()-this.dom.$results.width();this.dom.$results.width(this.dom.$elem.outerWidth()-k);b("li",this.dom.$results).hover(function(){g.focusItem(this)},
function(){});this.autoFill(r,e)&&this.focusItem(v)};b.Autocompleter.prototype.showResult=function(d,e){return b.isFunction(this.options.showResult)?this.options.showResult(d,e):d};b.Autocompleter.prototype.autoFill=function(d,e){var g,k,l,j;if(this.options.autoFill&&this.lastKeyPressed_!=8){g=String(d).toLowerCase();k=String(e).toLowerCase();l=d.length;j=e.length;if(g.substr(0,j)===k){this.dom.$elem.val(d);this.selectRange(j,l);return true}}return false};b.Autocompleter.prototype.focusNext=function(){this.focusMove(+1)};
b.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)};b.Autocompleter.prototype.focusMove=function(d){var e,g=b("li",this.dom.$results);d=parseInt(d);for(e=0;e<g.length;e++)if(b(g[e]).hasClass(this.selectClass_)){this.focusItem(e+d);return}this.focusItem(0)};b.Autocompleter.prototype.focusItem=function(d){var e=b("li",this.dom.$results);if(e.length){e.removeClass(this.selectClass_).removeClass(this.options.selectClass);if(typeof d==="number"){d=parseInt(d);if(d<0)d=0;else if(d>=e.length)d=
e.length-1;d=b(e[d])}else d=b(d);d&&d.addClass(this.selectClass_).addClass(this.options.selectClass)}};b.Autocompleter.prototype.selectCurrent=function(){var d=b("li."+this.selectClass_,this.dom.$results);d.length==1?this.selectItem(d):this.finish()};b.Autocompleter.prototype.selectItem=function(d){var e=d.data("value");d=d.data("data");var g=this.displayValue(e,d);this.lastSelectedValue_=this.lastProcessedValue_=g;this.dom.$elem.val(g).focus();this.setCaret(g.length);this.callHook("onItemSelect",
{value:e,data:d});this.finish()};b.Autocompleter.prototype.displayValue=function(d,e){return b.isFunction(this.options.displayValue)?this.options.displayValue(d,e):d};b.Autocompleter.prototype.finish=function(){this.keyTimeout_&&clearTimeout(this.keyTimeout_);if(this.dom.$elem.val()!==this.lastSelectedValue_){this.options.mustMatch&&this.dom.$elem.val("");this.callHook("onNoMatch")}this.dom.$results.hide();this.lastProcessedValue_=this.lastKeyPressed_=null;this.active_&&this.callHook("onFinish");
this.active_=false};b.Autocompleter.prototype.selectRange=function(d,e){var g=this.dom.$elem.get(0);if(g.setSelectionRange){g.focus();g.setSelectionRange(d,e)}else if(this.createTextRange){g=this.createTextRange();g.collapse(true);g.moveEnd("character",e);g.moveStart("character",d);g.select()}};b.Autocompleter.prototype.setCaret=function(d){this.selectRange(d,d)};b.fn.autocomplete=function(d){if(typeof d==="string")d={url:d};var e=b.extend({},b.fn.autocomplete.defaults,d);return this.each(function(){var g=
b(this),k=new b.Autocompleter(g,e);g.data("autocompleter",k)})};b.fn.autocomplete.defaults={minChars:1,loadingClass:"acLoading",resultsClass:"acResults",inputClass:"acInput",selectClass:"acSelect",mustMatch:false,matchCase:false,matchInside:true,matchSubset:true,useCache:true,maxCacheLength:10,autoFill:false,sortResults:true,sortFunction:false,onItemSelect:false,onNoMatch:false}})(jQuery);
(function(b){b.extend(b.fn,{livequery:function(d,e,g){var k=this,l;if(b.isFunction(d)){g=e;e=d;d=undefined}b.each(b.livequery.queries,function(j,m){if(k.selector==m.selector&&k.context==m.context&&d==m.type&&(!e||e.$lqguid==m.fn.$lqguid)&&(!g||g.$lqguid==m.fn2.$lqguid))return(l=m)&&false});l=l||new b.livequery(this.selector,this.context,d,e,g);l.stopped=false;l.run();return this},expire:function(d,e,g){var k=this;if(b.isFunction(d)){g=e;e=d;d=undefined}b.each(b.livequery.queries,function(l,j){if(k.selector==
j.selector&&k.context==j.context&&(!d||d==j.type)&&(!e||e.$lqguid==j.fn.$lqguid)&&(!g||g.$lqguid==j.fn2.$lqguid)&&!this.stopped)b.livequery.stop(j.id)});return this}});b.livequery=function(d,e,g,k,l){this.selector=d;this.context=e;this.type=g;this.fn=k;this.fn2=l;this.elements=[];this.stopped=false;this.id=b.livequery.queries.push(this)-1;k.$lqguid=k.$lqguid||b.livequery.guid++;if(l)l.$lqguid=l.$lqguid||b.livequery.guid++;return this};b.livequery.prototype={stop:function(){var d=this;if(this.type)this.elements.unbind(this.type,
this.fn);else this.fn2&&this.elements.each(function(e,g){d.fn2.apply(g)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var d=this,e=this.elements,g=b(this.selector,this.context),k=g.not(e);this.elements=g;if(this.type){k.bind(this.type,this.fn);e.length>0&&b.each(e,function(l,j){b.inArray(j,g)<0&&b.event.remove(j,d.type,d.fn)})}else{k.each(function(){d.fn.apply(this)});this.fn2&&e.length>0&&b.each(e,function(l,j){b.inArray(j,g)<0&&d.fn2.apply(j)})}}}};b.extend(b.livequery,
{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(b.livequery.running&&b.livequery.queue.length)for(var d=b.livequery.queue.length;d--;)b.livequery.queries[b.livequery.queue.shift()].run()},pause:function(){b.livequery.running=false},play:function(){b.livequery.running=true;b.livequery.run()},registerPlugin:function(){b.each(arguments,function(d,e){if(b.fn[e]){var g=b.fn[e];b.fn[e]=function(){var k=g.apply(this,arguments);b.livequery.run();return k}}})},run:function(d){if(d!=
undefined)b.inArray(d,b.livequery.queue)<0&&b.livequery.queue.push(d);else b.each(b.livequery.queries,function(e){b.inArray(e,b.livequery.queue)<0&&b.livequery.queue.push(e)});b.livequery.timeout&&clearTimeout(b.livequery.timeout);b.livequery.timeout=setTimeout(b.livequery.checkQueue,20)},stop:function(d){d!=undefined?b.livequery.queries[d].stop():b.each(b.livequery.queries,function(e){b.livequery.queries[e].stop()})}});b.livequery.registerPlugin("append","prepend","after","before","wrap","attr",
"removeAttr","addClass","removeClass","toggleClass","empty","remove","html");b(function(){b.livequery.play()})})(jQuery);
(function(b){b.fn.sexyPost=function(d){var e=["onstart","onprogress","oncomplete","onerror","onabort","onfilestart","onfilecomplete"],g={async:true,autoclear:false,onstart:function(){},onprogress:function(){},oncomplete:function(){},onerror:function(){},onabort:function(){}};d&&b.extend(g,d);this.each(function(){function k(m,r,v,w){var u=new FormData;b("input:text, input:hidden, input:password, textarea",m).each(function(){u.append(b(this).attr("name"),b(this).val())});b("input:file",m).each(function(){var y=
this.files;for(i=0;i<y.length;i++)u.append(b(this).attr("name"),y[i])});b("select option:selected",m).each(function(){u.append(b(this).parent().attr("name"),b(this).val())});b("input:checked",m).each(function(){u.append(b(this).attr("name"),b(this).val())});j.open(v,r,w);j.setRequestHeader("Cache-Control","no-cache");j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.send(u)}for(event in e)g[e[event]]&&b(this).bind("sexyPost."+e[event],g[e[event]]);var l=b(this);l.submit(function(){var m=b(this).attr("action"),
r=b(this).attr("method");k(this,m,r,g.async);return false});b(".submit-trigger",l).not(":button").bind("change",function(){l.trigger("submit")});b(".submit-trigger",l).not(":input").bind("click",function(){l.trigger("submit")});var j=new XMLHttpRequest;j.onloadstart=function(){l.trigger("sexyPost.onstart")};j.onload=function(){g.autoclear&&j.status>=200&&j.status<=204&&b(":input",l).not(":button, :submit, :reset, :hidden").removeAttr("checked").removeAttr("selected").val("");l.trigger("sexyPost.oncomplete",
[j.responseText])};j.onerror=function(){l.trigger("sexyPost.onerror")};j.onabort=function(){l.trigger("sexyPost.onabort")};j.upload.onprogress=function(m){l.trigger("sexyPost.onprogress",[m.loaded/m.total,m.loaded,m.total])}});return this}})(jQuery);
(function(b,d){var e,g=/:([\w\d]+)/g,k=/\?([^#]*)$/,l=function(a){return Array.prototype.slice.call(a)},j=function(a){return Object.prototype.toString.call(a)==="[object Function]"},m=function(a){return Object.prototype.toString.call(a)==="[object Array]"},r=decodeURIComponent,v=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},w=function(a){return function(c,f){return this.route.apply(this,[a,c,f])}},u={},y=[];e=function(){var a=l(arguments),c,f;e.apps=e.apps||
{};if(a.length===0||a[0]&&j(a[0]))return e.apply(e,["body"].concat(a));else if(typeof(f=a.shift())=="string"){c=e.apps[f]||new e.Application;c.element_selector=f;a.length>0&&b.each(a,function(h,o){c.use(o)});c.element_selector!=f&&delete e.apps[f];return e.apps[c.element_selector]=c}};e.VERSION="0.6.2";e.addLogger=function(a){y.push(a)};e.log=function(){var a=l(arguments);a.unshift("["+Date()+"]");b.each(y,function(c,f){f.apply(e,a)})};if(typeof d.console!="undefined")j(console.log.apply)?e.addLogger(function(){d.console.log.apply(console,
arguments)}):e.addLogger(function(){d.console.log(arguments)});else typeof console!="undefined"&&e.addLogger(function(){console.log.apply(console,arguments)});b.extend(e,{makeArray:l,isFunction:j,isArray:m});e.Object=function(a){return b.extend(this,a||{})};b.extend(e.Object.prototype,{escapeHTML:v,h:v,toHash:function(){var a={};b.each(this,function(c,f){j(f)||(a[c]=f)});return a},toHTML:function(){var a="";b.each(this,function(c,f){j(f)||(a+="<strong>"+c+"</strong> "+f+"<br />")});return a},keys:function(a){var c=
[],f;for(f in this)if(!j(this[f])||!a)c.push(f);return c},has:function(a){return this[a]&&b.trim(this[a].toString())!=""},join:function(){var a=l(arguments),c=a.shift();return a.join(c)},log:function(){e.log.apply(e,arguments)},toString:function(a){var c=[];b.each(this,function(f,h){if(!j(h)||a)c.push('"'+f+'": '+h.toString())});return"Sammy.Object: {"+c.join(",")+"}"}});e.HashLocationProxy=function(a,c){this.app=a;this.is_native=false;this._startPolling(c)};e.HashLocationProxy.prototype={bind:function(){var a=
this,c=this.app;b(d).bind("hashchange."+this.app.eventNamespace(),function(f,h){if(a.is_native===false&&!h){e.log("native hash change exists, using");a.is_native=true;d.clearInterval(e.HashLocationProxy._interval)}c.trigger("location-changed")});if(!e.HashLocationProxy._bindings)e.HashLocationProxy._bindings=0;e.HashLocationProxy._bindings++},unbind:function(){b(d).unbind("hashchange."+this.app.eventNamespace());e.HashLocationProxy._bindings--;e.HashLocationProxy._bindings<=0&&d.clearInterval(e.HashLocationProxy._interval)},
getLocation:function(){var a=d.location.toString().match(/^[^#]*(#.+)$/);return a?a[1]:""},setLocation:function(a){return d.location=a},_startPolling:function(a){var c=this;if(!e.HashLocationProxy._interval){a||(a=10);var f=function(){var h=c.getLocation();if(!e.HashLocationProxy._last_location||h!=e.HashLocationProxy._last_location)d.setTimeout(function(){b(d).trigger("hashchange",[true])},13);e.HashLocationProxy._last_location=h};f();e.HashLocationProxy._interval=d.setInterval(f,a)}}};e.Application=
function(a){var c=this;this.routes={};this.listeners=new e.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1E3,10);this.context_prototype=function(){e.EventContext.apply(this,arguments)};this.context_prototype.prototype=new e.EventContext;j(a)&&a.apply(this,[this]);this._location_proxy||this.setLocationProxy(new e.HashLocationProxy(this,this.run_interval_every));this.debug&&this.bindToAllEvents(function(f,h){c.log(c.toString(),f.cleaned_type,
h||{})})};e.Application.prototype=b.extend({},e.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:false,element_selector:"body",debug:false,raise_errors:false,run_interval_every:50,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},
$element:function(){return b(this.element_selector)},use:function(){var a=l(arguments),c=a.shift(),f=c||"";try{a.unshift(this);if(typeof c=="string"){f="Sammy."+c;c=e[c]}c.apply(this,a)}catch(h){if(typeof c==="undefined")this.error("Plugin Error: called use() but plugin ("+f.toString()+") is not defined",h);else j(c)?this.error("Plugin Error",h):this.error("Plugin Error: called use() but '"+f.toString()+"' is not a function",h)}return this},setLocationProxy:function(a){var c=this._location_proxy;
this._location_proxy=a;if(this.isRunning()){c&&c.unbind();this._location_proxy.bind()}},route:function(a,c,f){var h=this,o=[],n,p;if(!f&&j(c)){f=c=a;a="any"}a=a.toLowerCase();if(c.constructor==String){for(g.lastIndex=0;(p=g.exec(c))!==null;)o.push(p[1]);c=RegExp("^"+c.replace(g,"([^/]+)")+"$")}if(typeof f=="string")f=h[f];n=function(q){var s={verb:q,path:c,callback:f,param_names:o};h.routes[q]=h.routes[q]||[];h.routes[q].push(s)};a==="any"?b.each(this.ROUTE_VERBS,function(q,s){n(s)}):n(a);return this},
get:w("get"),post:w("post"),put:w("put"),del:w("delete"),any:w("any"),mapRoutes:function(a){var c=this;b.each(a,function(f,h){c.route.apply(c,h)});return this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(a,c,f){var h=this;if(typeof f=="undefined")f=c;c=function(o,n){var p;if(n&&n.context){p=n.context;delete n.context}else p=new h.context_prototype(h,"bind",o.type,n,o.target);o.cleaned_type=o.type.replace(h.eventNamespace(),"");f.apply(p,[o,n])};this.listeners[a]||
(this.listeners[a]=[]);this.listeners[a].push(c);this.isRunning()&&this._listen(a,c);return this},trigger:function(a,c){this.$element().trigger([a,this.eventNamespace()].join("."),[c]);return this},refresh:function(){this.last_location=null;this.trigger("location-changed");return this},before:function(a,c){if(j(a)){c=a;a={}}this.befores.push([a,c]);return this},after:function(a){return this.bind("event-context-after",a)},around:function(a){this.arounds.push(a);return this},isRunning:function(){return this._running},
helpers:function(a){b.extend(this.context_prototype.prototype,a);return this},helper:function(a,c){this.context_prototype.prototype[a]=c;return this},run:function(a){if(this.isRunning())return false;var c=this;b.each(this.listeners.toHash(),function(f,h){b.each(h,function(o,n){c._listen(f,n)})});this.trigger("run",{start_url:a});this._running=true;this.last_location=null;this.getLocation()==""&&typeof a!="undefined"&&this.setLocation(a);this._checkLocation();this._location_proxy.bind();this.bind("location-changed",
function(){c._checkLocation()});this.bind("submit",function(f){return c._checkFormSubmission(b(f.target).closest("form"))===false?f.preventDefault():false});b(d).bind("beforeunload",function(){c.unload()});return this.trigger("changed")},unload:function(){if(!this.isRunning())return false;var a=this;this.trigger("unload");this._location_proxy.unbind();this.$element().unbind("submit").removeClass(a.eventNamespace());b.each(this.listeners.toHash(),function(c,f){b.each(f,function(h,o){a._unlisten(c,
o)})});this._running=false;return this},bindToAllEvents:function(a){var c=this;b.each(this.APP_EVENTS,function(f,h){c.bind(h,a)});b.each(this.listeners.keys(true),function(f,h){c.APP_EVENTS.indexOf(h)==-1&&c.bind(h,a)});return this},routablePath:function(a){return a.replace(k,"")},lookupRoute:function(a,c){var f=this,h=false;this.trigger("lookup-route",{verb:a,path:c});typeof this.routes[a]!="undefined"&&b.each(this.routes[a],function(o,n){if(f.routablePath(c).match(n.path)){h=n;return false}});return h},
runRoute:function(a,c,f,h){var o=this,n=this.lookupRoute(a,c),p,q,s,t,B,A,C;this.log("runRoute",[a,c].join(" "));this.trigger("run-route",{verb:a,path:c,params:f});if(typeof f=="undefined")f={};b.extend(f,this._parseQueryString(c));if(n){this.trigger("route-found",{route:n});if((A=n.path.exec(this.routablePath(c)))!==null){A.shift();b.each(A,function(x,z){if(n.param_names[x])f[n.param_names[x]]=r(z);else{if(!f.splat)f.splat=[];f.splat.push(r(z))}})}p=new this.context_prototype(this,a,c,f,h);h=this.arounds.slice(0);
s=this.befores.slice(0);B=[p].concat(f.splat);q=function(){for(var x;s.length>0;){t=s.shift();if(o.contextMatchesOptions(p,t[0])){x=t[1].apply(p,[p]);if(x===false)return false}}o.last_route=n;p.trigger("event-context-before",{context:p});x=n.callback.apply(p,B);p.trigger("event-context-after",{context:p});return x};b.each(h.reverse(),function(x,z){var D=q;q=function(){return z.apply(p,[D])}});try{C=q()}catch(E){this.error(["500 Error",a,c].join(" "),E)}return C}else return this.notFound(a,c)},contextMatchesOptions:function(a,
c,f){c=c;if(typeof c==="undefined"||c=={})return true;if(typeof f==="undefined")f=true;if(typeof c==="string"||j(c.test))c={path:c};if(c.only)return this.contextMatchesOptions(a,c.only,true);else if(c.except)return this.contextMatchesOptions(a,c.except,false);var h=true,o=true;if(c.path)h=j(c.path.test)?c.path.test(a.path):c.path.toString()===a.path;if(c.verb)o=c.verb===a.verb;return f?o&&h:!(o&&h)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(a){return this._location_proxy.setLocation(a)},
swap:function(a){return this.$element().html(a)},templateCache:function(a,c){return typeof c!="undefined"?u[a]=c:u[a]},clearTemplateCache:function(){return u={}},notFound:function(a,c){var f=this.error(["404 Not Found",a,c].join(" "));return a==="get"?f:true},error:function(a,c){c||(c=Error());c.message=[a,c.message].join(" ");this.trigger("error",{message:c.message,error:c});if(this.raise_errors)throw c;else this.log(c.message,c)},_checkLocation:function(){var a,c;a=this.getLocation();if(!this.last_location||
this.last_location[0]!="get"||this.last_location[1]!=a){this.last_location=["get",a];c=this.runRoute("get",a)}return c},_getFormVerb:function(a){a=b(a);var c,f;f=a.find('input[name="_method"]');if(f.length>0)c=f.val();c||(c=a[0].getAttribute("method"));return b.trim(c.toString().toLowerCase())},_checkFormSubmission:function(a){var c,f,h;this.trigger("check-form-submission",{form:a});c=b(a);f=c.attr("action");h=this._getFormVerb(c);if(!h||h=="")h="get";this.log("_checkFormSubmission",c,f,h);if(h===
"get"){this.setLocation(f+"?"+c.serialize());a=false}else{c=b.extend({},this._parseFormParams(c));a=this.runRoute(h,f,c,a.get(0))}return typeof a=="undefined"?false:a},_parseFormParams:function(a){var c={};a=a.serializeArray();var f;for(f=0;f<a.length;f++)c=this._parseParamPair(c,a[f].name,a[f].value);return c},_parseQueryString:function(a){var c={},f,h;if(a=a.match(k)){a=a[1].split("&");for(h=0;h<a.length;h++){f=a[h].split("=");c=this._parseParamPair(c,r(f[0]),r(f[1]))}}return c},_parseParamPair:function(a,
c,f){if(a[c])if(m(a[c]))a[c].push(f);else a[c]=[a[c],f];else a[c]=f;return a},_listen:function(a,c){return this.$element().bind([a,this.eventNamespace()].join("."),c)},_unlisten:function(a,c){return this.$element().unbind([a,this.eventNamespace()].join("."),c)}});e.RenderContext=function(a){this.event_context=a;this.callbacks=[];this.content=this.previous_content=null;this.waiting=this.next_engine=false};b.extend(e.RenderContext.prototype,{then:function(a){if(!j(a))if(typeof a==="string"&&a in this.event_context){var c=
this.event_context[a];a=function(h){return c.apply(this.event_context,[h])}}else return this;var f=this;if(this.waiting)this.callbacks.push(a);else{this.wait();d.setTimeout(function(){var h=a.apply(f,[f.content,f.previous_content]);h!==false&&f.next(h)},13)}return this},wait:function(){this.waiting=true},next:function(a){this.waiting=false;if(typeof a!=="undefined"){this.previous_content=this.content;this.content=a}this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(a,c,f){var h=
this;return this.then(function(){var o,n,p;if(j(c)){f=c;c={}}else c=b.extend({},c);f&&this.then(f);if(typeof a==="string"){o=(p=a.match(/\.json$/)||c.json)&&c.cache===true||c.cache!==false;h.next_engine=h.event_context.engineFor(a);delete c.cache;delete c.json;if(c.engine){h.next_engine=c.engine;delete c.engine}if(o&&(n=this.event_context.app.templateCache(a)))return n;this.wait();b.ajax(b.extend({url:a,data:{},dataType:p?"json":null,type:"get",success:function(q){o&&h.event_context.app.templateCache(a,
q);h.next(q)}},c));return false}else{if(a.nodeType)return a.innerHTML;if(a.selector){h.next_engine=a.attr("data-engine");return c.clone===false?a.remove()[0].innerHTML.toString():a[0].innerHTML.toString()}}})},render:function(a,c,f){if(j(a)&&!c)return this.then(a);else{if(!c&&this.content)c=this.content;return this.load(a).interpolate(c,a).then(f)}},partial:function(a,c){return this.render(a,c).swap()},send:function(){var a=this,c=l(arguments),f=c.shift();if(m(c[0]))c=c[0];return this.then(function(){c.push(function(h){a.next(h)});
a.wait();f.apply(f,c);return false})},collect:function(a,c,f){var h=this,o=function(){if(j(a)){c=a;a=this.content}var n=[],p=false;b.each(a,function(q,s){var t=c.apply(h,[q,s]);if(t.jquery&&t.length==1){t=t[0];p=true}n.push(t);return t});return p?n:n.join("")};return f?o():this.then(o)},renderEach:function(a,c,f,h){if(m(c)){h=f;f=c;c=null}return this.load(a).then(function(o){var n=this;f||(f=m(this.previous_content)?this.previous_content:[]);if(h)b.each(f,function(p,q){var s={},t=this.next_engine||
a;c?s[c]=q:s=q;h(q,n.event_context.interpolate(o,s,t))});else return this.collect(f,function(p,q){var s={},t=this.next_engine||a;c?s[c]=q:s=q;return this.event_context.interpolate(o,s,t)},true)})},interpolate:function(a,c,f){var h=this;return this.then(function(o,n){if(!a&&n)a=n;if(this.next_engine){c=this.next_engine;this.next_engine=false}var p=h.event_context.interpolate(o,a,c);return f?n+p:p})},swap:function(){return this.then(function(a){this.event_context.swap(a)}).trigger("changed",{})},appendTo:function(a){return this.then(function(c){b(a).append(c)}).trigger("changed",
{})},prependTo:function(a){return this.then(function(c){b(a).prepend(c)}).trigger("changed",{})},replace:function(a){return this.then(function(c){b(a).html(c)}).trigger("changed",{})},trigger:function(a,c){return this.then(function(f){if(typeof c=="undefined")c={content:f};this.event_context.trigger(a,c)})}});e.EventContext=function(a,c,f,h,o){this.app=a;this.verb=c;this.path=f;this.params=new e.Object(h);this.target=o};e.EventContext.prototype=b.extend({},e.Object.prototype,{$element:function(){return this.app.$element()},
engineFor:function(a){var c;if(j(a))return a;a=a.toString();if(c=a.match(/\.([^\.]+)$/))a=c[1];if(a&&j(this[a]))return this[a];if(this.app.template_engine)return this.engineFor(this.app.template_engine);return function(f){return f}},interpolate:function(a,c,f){return this.engineFor(f).apply(this,[a,c])},render:function(a,c,f){return(new e.RenderContext(this)).render(a,c,f)},renderEach:function(a,c,f,h){return(new e.RenderContext(this)).renderEach(a,c,f,h)},load:function(a,c,f){return(new e.RenderContext(this)).load(a,
c,f)},partial:function(a,c){return(new e.RenderContext(this)).partial(a,c)},send:function(){var a=new e.RenderContext(this);return a.send.apply(a,arguments)},redirect:function(){var a;a=l(arguments);var c=this.app.getLocation();if(a.length>1){a.unshift("/");a=this.join.apply(this,a)}else a=a[0];this.trigger("redirect",{to:a});this.app.last_location=[this.verb,this.path];this.app.setLocation(a);c==a&&this.app.trigger("location-changed")},trigger:function(a,c){if(typeof c=="undefined")c={};if(!c.context)c.context=
this;return this.app.trigger(a,c)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(a){return this.app.swap(a)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(a){return b.parseJSON(a)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}});b.sammy=d.Sammy=e})(jQuery,window);
(function(b){b.blabbrNotify=function(d,e){setTimeout(function(){b("#notify").children().hide("slow").remove()},5E3);b("#notify").append('<p class="'+d+'">'+e+"</p>")};b.redirectTo=function(d){if(history.pushState){getAndShow(ajaxPath(d),"#contents");history.pushState({path:d},"",d)}else window.location="/#"+d;b("aside").hide("slow")}})(jQuery);var root=history.pushState?"/":"#/";
(function(b){Sammy=Sammy||{};Sammy.PushLocationProxy=function(d){this.app=d};Sammy.PushLocationProxy.prototype={bind:function(){var d=this;b(window).bind("popstate",function(){d.app.trigger("location-changed")});b("a").live("click",function(e){if(location.hostname==this.hostname){e.preventDefault();d.setLocation(b(this).attr("href"));d.app.trigger("location-changed")}})},unbind:function(){b("a").unbind("click");b(window).unbind("popstate")},getLocation:function(){return window.location.pathname},
setLocation:function(d){history.pushState({path:this.path},"",d)}}})(jQuery);
(function(b){var d=b.sammy(function(){this.notFound=function(e,g){document.location.href=g};history.pushState&&this.setLocationProxy(new Sammy.PushLocationProxy(this));this.before(function(){path=ajaxPath(this.path);loadingNotification()});this.after(function(){if(typeof _gaq!=="undefined"){_gaq.push(["_trackPageview"]);_gaq.push(["_trackEvent",this.path,this.verb,"blabbr"])}});this.get(root,function(){getAndShow(path,"#contents")});this.get(root+"topics",function(){getAndShow(path,"aside")});this.get(root+
"topics/new",function(){getAndShow(path,"aside")});this.post("/topics",function(){postAndShow(path,this.params)});this.get(root+"topics/page/:page_id",function(){getAndShow(path,"#contents")});this.get(root+"topics/:id",function(){subscribeToPusher(this.params.id);getAndShow(path,"#contents")});this.get(root+"topics/:id/edit",function(){getAndShow(path,"aside")});this.put("/topics/:id",function(){postAndAdd(path,this.params);getAndShow(path,"#contents")});this.post("/topics/:id/posts",function(){postAndAdd(path,
this.params)});this.post("/topics/:id/members",function(){postAndAdd(path,this.params)});this.get(root+"topics/:id/page/:page_id",function(){subscribeToPusher(this.params.id);getAndShow(path,"#contents")});this.get(root+"topics/:id/page/:page_id/:anchor",function(){subscribeToPusher(this.params.id);params=this.params;getAndScroll("/topics/"+params.id+"/page/"+params.page_id+".js","#contents",params.anchor)});this.get(root+"topics/:id/posts/:post_id/edit",function(){var e=this.params.post_id;b.get(path,
function(g){g&&showEdit(g,e)})});this.put("/topics/:id/posts/:post_id",function(){postAndReplace(path,this.params)});this.get(root+"users/:id",function(){getAndShow(path,"aside")});this.put("/users/:id",function(){postAndShow(path,this.params)});this.get(root+"dashboard",function(){getAndShow(path,"aside")});this.get(root+"smilies",function(){getAndShow(path)});this.get(root+"smilies/new",function(){getAndShow(path,"aside")})});b(function(){d.run(root)})})(jQuery);var titleHolder=document.title;
jQuery(function(b){b("input.autocomplete").livequery(function(){b(this).each(function(){var d=b(this);d.autocomplete(d.attr("data-autocomplete-url"))})});b("#new_smiley").livequery(function(){b(this).sexyPost({onprogress:function(d,e){b("#status").text("Uploading: "+(e*100).toFixed(2)+"% complete...")},oncomplete:function(){b("#status").text("Upload complete.")}})});history.pushState||b("a[href^=/][class!='no-ajax']").livequery(function(){var d=b(this).attr("href");b(this).attr("href","#"+d.replace("#",
"/"))});b(".simple_form.user").livequery(function(){b(this).sexyPost({onprogress:function(d,e){b("#status").text("Uploading: "+(e*100).toFixed(2)+"% complete...")},oncomplete:function(){b("#status").text("Upload complete.")}})});b("html").mouseover(function(){gainedFocus()});b(".bubble p, .bubble ul").live("click",function(d){if(b(d.target).is("p, ul")){d=b(this).parent().get(0).getAttribute("data_user");insertQuote(b(this).text(),d)}})});
function insertQuote(b,d){$("#post_body").val($("#post_body").val()+"bq..:"+d+" "+b+" \n\np. ")}function ajaxPath(b){return history.pushState?"/"+b.substr(1)+".js":b.substr(1)+".js"}function showPost(b,d){$.get(b,function(e){if(e){$(e).hide().appendTo("#posts").show("slow");d!=user_id&&notify();hideLoadingNotification()}},"js")}function showEdit(b,d){$("#"+d).find("div").html(b);hideLoadingNotification()}
function getAndShow(b,d){$.ajax({type:"GET",url:b,dataType:"html",success:function(e){if(e){showContent(e,d);setTitle($(".page-title").attr("title"));window.location.hash&&goToByScroll(window.location.hash)}}})}function postAndShow(b,d){$.ajax({type:"POST",url:b,dataType:"html",data:$.param(d.toHash()),success:function(e){showContent(e,"#contents")}})}
function postAndReplace(b,d){$.ajax({type:"POST",url:b,dataType:"html",data:$.param(d.toHash()),success:function(e){replaceContent(e,d.post_id)}})}function postAndAdd(b,d){$.ajax({type:"POST",url:b,dataType:"html",data:$.param(d.toHash()),success:function(e){addContent(e)}})}function subscribeToPusher(b){pusher||(pusher=new Pusher($("body").attr("id")));pusher.channels.channels[b]||pusher.subscribe(b).bind("new-post",function(d){showPost("/topics/"+b+"/posts/"+d.id+".js",d.user_id)})}
function showContent(b,d){$(d).show().html(b);hideLoadingNotification()}function setTitle(b){$("#page-title").html(b);document.title="Blabbr - "+b}function replaceContent(b,d){$("#"+d+" .bubble").html(b);hideLoadingNotification()}function addContent(b){$("#contents").append(b);hideLoadingNotification()}function notify(){lostFocus();blinkTitle(1);user_audio&&audioNotification()}
>>>>>>> ux-rework
function blinkTitle(b){if(windowIsActive!=true){if(b==1){document.title="[new!] - "+titleHolder;b=0}else{document.title=""+titleHolder;b=1}setTimeout("blinkTitle("+b+")",1600)}else document.title=titleHolder}function audioNotification(){$("body").append('<audio id="player" src="/sound.mp3" autoplay />');var b=$("#player");$(b).bind("ended",function(){$(this)})}function lostFocus(){windowIsActive=false}function gainedFocus(){windowIsActive=true}
function loadingNotification(){$("#contents").append('<p class="loading"></p>')}function hideLoadingNotification(){$(".loading").hide()}function goToByScroll(b){$(b).livequery(function(){$(this).addClass("anchor");$("html,body").animate({scrollTop:$(this).offset().top},"slow");$(b).livequery().expire()})};
