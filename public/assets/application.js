jQuery(function(c){var a=c("meta[name=csrf-token]").attr("content"),d=c("meta[name=csrf-param]").attr("content");c.fn.extend({triggerAndReturn:function(b,e){var f=new c.Event(b);this.trigger(f,e);return f.result!==false},callRemote:function(){var b=this,e=b.is("form")?b.serializeArray():[],f=b.attr("method")||b.attr("data-method")||"GET",g=b.attr("action")||b.attr("href");if(g===undefined)throw"No URL specified for remote call (action or href must be present).";else{b.triggerAndReturn("ajax:before")&&
c.ajax({url:g,data:e,dataType:"script",type:f.toUpperCase(),beforeSend:function(h){b.trigger("ajax:loading",h)},success:function(h,i,j){b.trigger("ajax:success",[h,i,j])},complete:function(h){b.trigger("ajax:complete",h)},error:function(h,i,j){b.trigger("ajax:failure",[h,i,j])}});b.trigger("ajax:after")}}});c("a[data-confirm],input[data-confirm]").live("click",function(){var b=c(this);if(b.triggerAndReturn("confirm"))if(!confirm(b.attr("data-confirm")))return false});c("form[data-remote]").live("submit",
function(b){c(this).callRemote();b.preventDefault()});c("a[data-remote],input[data-remote]").live("click",function(b){c(this).callRemote();b.preventDefault()});c("a[data-method]:not([data-remote])").live("click",function(b){var e=c(this),f=e.attr("href");e=e.attr("data-method");f=c('<form method="post" action="'+f+'">');e='<input name="_method" value="'+e+'" type="hidden" />';if(d!=null&&a!=null)e+='<input name="'+d+'" value="'+a+'" type="hidden" />';f.hide().append(e).appendTo("body");b.preventDefault();
f.submit()});c("form[data-remote]:has(input[data-disable-with])").live("ajax:before",function(){c(this).find("input[data-disable-with]").each(function(){var b=c(this);b.data("enable-with",b.val()).attr("value",b.attr("data-disable-with")).attr("disabled","disabled")})});c("form[data-remote]:has(input[data-disable-with])").live("ajax:after",function(){c(this).find("input[data-disable-with]").each(function(){var b=c(this);b.removeAttr("disabled").val(b.data("enable-with"))})})});
(function(c){c.Autocompleter=function(a,d){this.cacheData_={};this.cacheLength_=0;this.selectClass_="jquery-autocomplete-selected-item";this.lastSelectedValue_=this.lastProcessedValue_=this.lastKeyPressed_=this.keyTimeout_=null;this.active_=false;this.finishOnBlur_=true;if(!a||!(a instanceof jQuery)||a.length!==1||a.get(0).tagName.toUpperCase()!=="INPUT")alert("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected");else{this.options=typeof d==="string"?
{url:d}:d;this.options.maxCacheLength=parseInt(this.options.maxCacheLength);if(isNaN(this.options.maxCacheLength)||this.options.maxCacheLength<1)this.options.maxCacheLength=1;this.options.minChars=parseInt(this.options.minChars);if(isNaN(this.options.minChars)||this.options.minChars<1)this.options.minChars=1;this.dom={};this.dom.$elem=a;this.options.inputClass&&this.dom.$elem.addClass(this.options.inputClass);this.dom.$results=c("<div></div>").hide();this.options.resultsClass&&this.dom.$results.addClass(this.options.resultsClass);
this.dom.$results.css({position:"absolute"});c("body").append(this.dom.$results);var b=this;this.position();c(window).resize(function(){b.position()});a.keydown(function(e){b.lastKeyPressed_=e.keyCode;switch(b.lastKeyPressed_){case 38:e.preventDefault();b.active_?b.focusPrev():b.activate();return false;case 40:e.preventDefault();b.active_?b.focusNext():b.activate();return false;case 9:case 13:if(b.active_){e.preventDefault();b.selectCurrent();return false}break;case 27:if(b.active_){e.preventDefault();
b.finish();return false}break;default:b.activate()}});a.blur(function(){b.finishOnBlur_&&setTimeout(function(){b.finish()},200)})}};c.Autocompleter.prototype.position=function(){var a=this.dom.$elem.offset();this.dom.$results.css({top:a.top+this.dom.$elem.outerHeight(),left:a.left})};c.Autocompleter.prototype.cacheRead=function(a){var d,b,e,f,g;if(this.options.useCache){a=String(a);d=a.length;for(b=this.options.matchSubset?1:d;b<=d;){f=this.options.matchInside?d-b:0;for(g=0;g<=f;){e=a.substr(0,b);
if(this.cacheData_[e]!==undefined)return this.cacheData_[e];g++}b++}}return false};c.Autocompleter.prototype.cacheWrite=function(a,d){if(this.options.useCache){this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush();a=String(a);this.cacheData_[a]!==undefined&&this.cacheLength_++;return this.cacheData_[a]=d}return false};c.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};c.Autocompleter.prototype.callHook=function(a,d){var b=this.options[a];if(b&&c.isFunction(b))return b(d,
this);return false};c.Autocompleter.prototype.activate=function(){var a=this,d=parseInt(this.options.delay);if(isNaN(d)||d<=0)d=250;this.keyTimeout_&&clearTimeout(this.keyTimeout_);this.keyTimeout_=setTimeout(function(){a.activateNow()},d)};c.Autocompleter.prototype.activateNow=function(){var a=this.dom.$elem.val();if(a!==this.lastProcessedValue_&&a!==this.lastSelectedValue_)if(a.length>=this.options.minChars){this.active_=true;this.lastProcessedValue_=a;this.fetchData(a)}};c.Autocompleter.prototype.fetchData=
function(a){if(this.options.data)this.filterAndShowResults(this.options.data,a);else{var d=this;this.fetchRemoteData(a,function(b){d.filterAndShowResults(b,a)})}};c.Autocompleter.prototype.fetchRemoteData=function(a,d){var b=this.cacheRead(a);if(b)d(b);else try{var e=this;this.dom.$elem.addClass(this.options.loadingClass);c.get(this.makeUrl(a),function(g){g=e.parseRemoteData(g);e.cacheWrite(a,g);e.dom.$elem.removeClass(e.options.loadingClass);d(g)})}catch(f){this.dom.$elem.removeClass(this.options.loadingClass);
d(false)}};c.Autocompleter.prototype.setExtraParam=function(a,d){var b=c.trim(String(a));if(b){if(!this.options.extraParams)this.options.extraParams={};if(this.options.extraParams[b]!==d){this.options.extraParams[b]=d;this.cacheFlush()}}};c.Autocompleter.prototype.makeUrl=function(a){var d=this,b=this.options.paramName||"q",e=this.options.url,f=c.extend({},this.options.extraParams),g=[];f[b]=a;c.each(f,function(h,i){g.push(d.makeUrlParam(h,i))});e+=e.indexOf("?")==-1?"?":"&";e+=g.join("&");return e};
c.Autocompleter.prototype.makeUrlParam=function(a,d){return String(a)+"="+encodeURIComponent(d)};c.Autocompleter.prototype.parseRemoteData=function(a){var d=[],b,e,f,g=String(a).replace("\r\n","\n").split("\n");for(a=0;a<g.length;a++){f=g[a].split("|");e=[];for(b=0;b<f.length;b++)e.push(unescape(f[b]));b=e.shift();d.push({value:unescape(b),data:e})}return d};c.Autocompleter.prototype.filterAndShowResults=function(a,d){this.showResults(this.filterResults(a,d),d)};c.Autocompleter.prototype.filterResults=
function(a,d){var b=[],e,f,g,h,i,j="";for(g=0;g<a.length;g++){h=a[g];i=typeof h;if(i==="string"){e=h;f={}}else if(c.isArray(h)){e=h.shift();f=h}else if(i==="object"){e=h.value;f=h.data}if(e=String(e)){if(typeof f!=="object")f={};h=String(d);this.options.matchInside||(h="^"+h);this.options.matchCase||(j="i");h=new RegExp(h,j);h.test(e)&&b.push({value:e,data:f})}}if(this.options.sortResults)return this.sortResults(b);return b};c.Autocompleter.prototype.sortResults=function(a){var d=this;c.isFunction(this.options.sortFunction)?
a.sort(this.options.sortFunction):a.sort(function(b,e){return d.sortValueAlpha(b,e)});return a};c.Autocompleter.prototype.sortValueAlpha=function(a,d){a=String(a.value);d=String(d.value);if(!this.options.matchCase){a=a.toLowerCase();d=d.toLowerCase()}if(a>d)return 1;if(a<d)return-1;return 0};c.Autocompleter.prototype.showResults=function(a,d){var b=this,e=c("<ul></ul>"),f,g,h,i=false,j=false,k=a.length;for(f=0;f<k;f++){g=a[f];h=c("<li>"+this.showResult(g.value,g.data)+"</li>");h.data("value",g.value);
h.data("data",g.data);h.click(function(){var l=c(this);b.selectItem(l)}).mousedown(function(){b.finishOnBlur_=false}).mouseup(function(){b.finishOnBlur_=true});e.append(h);if(i===false){i=String(g.value);j=h;h.addClass(this.options.firstItemClass)}f==k-1&&h.addClass(this.options.lastItemClass)}this.dom.$results.html(e).show();e=this.dom.$results.outerWidth()-this.dom.$results.width();this.dom.$results.width(this.dom.$elem.outerWidth()-e);c("li",this.dom.$results).hover(function(){b.focusItem(this)},
function(){});this.autoFill(i,d)&&this.focusItem(j)};c.Autocompleter.prototype.showResult=function(a,d){return c.isFunction(this.options.showResult)?this.options.showResult(a,d):a};c.Autocompleter.prototype.autoFill=function(a,d){var b,e,f,g;if(this.options.autoFill&&this.lastKeyPressed_!=8){b=String(a).toLowerCase();e=String(d).toLowerCase();f=a.length;g=d.length;if(b.substr(0,g)===e){this.dom.$elem.val(a);this.selectRange(g,f);return true}}return false};c.Autocompleter.prototype.focusNext=function(){this.focusMove(+1)};
c.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)};c.Autocompleter.prototype.focusMove=function(a){var d,b=c("li",this.dom.$results);a=parseInt(a);for(d=0;d<b.length;d++)if(c(b[d]).hasClass(this.selectClass_)){this.focusItem(d+a);return}this.focusItem(0)};c.Autocompleter.prototype.focusItem=function(a){var d=c("li",this.dom.$results);if(d.length){d.removeClass(this.selectClass_).removeClass(this.options.selectClass);if(typeof a==="number"){a=parseInt(a);if(a<0)a=0;else if(a>=d.length)a=
d.length-1;a=c(d[a])}else a=c(a);a&&a.addClass(this.selectClass_).addClass(this.options.selectClass)}};c.Autocompleter.prototype.selectCurrent=function(){var a=c("li."+this.selectClass_,this.dom.$results);a.length==1?this.selectItem(a):this.finish()};c.Autocompleter.prototype.selectItem=function(a){var d=a.data("value");a=a.data("data");var b=this.displayValue(d,a);this.lastSelectedValue_=this.lastProcessedValue_=b;this.dom.$elem.val(b).focus();this.setCaret(b.length);this.callHook("onItemSelect",
{value:d,data:a});this.finish()};c.Autocompleter.prototype.displayValue=function(a,d){return c.isFunction(this.options.displayValue)?this.options.displayValue(a,d):a};c.Autocompleter.prototype.finish=function(){this.keyTimeout_&&clearTimeout(this.keyTimeout_);if(this.dom.$elem.val()!==this.lastSelectedValue_){this.options.mustMatch&&this.dom.$elem.val("");this.callHook("onNoMatch")}this.dom.$results.hide();this.lastProcessedValue_=this.lastKeyPressed_=null;this.active_&&this.callHook("onFinish");
this.active_=false};c.Autocompleter.prototype.selectRange=function(a,d){var b=this.dom.$elem.get(0);if(b.setSelectionRange){b.focus();b.setSelectionRange(a,d)}else if(this.createTextRange){b=this.createTextRange();b.collapse(true);b.moveEnd("character",d);b.moveStart("character",a);b.select()}};c.Autocompleter.prototype.setCaret=function(a){this.selectRange(a,a)};c.fn.autocomplete=function(a){if(typeof a==="string")a={url:a};var d=c.extend({},c.fn.autocomplete.defaults,a);return this.each(function(){var b=
c(this),e=new c.Autocompleter(b,d);b.data("autocompleter",e)})};c.fn.autocomplete.defaults={minChars:1,loadingClass:"acLoading",resultsClass:"acResults",inputClass:"acInput",selectClass:"acSelect",mustMatch:false,matchCase:false,matchInside:true,matchSubset:true,useCache:true,maxCacheLength:10,autoFill:false,sortResults:true,sortFunction:false,onItemSelect:false,onNoMatch:false}})(jQuery);var titleHolder=document.title;
jQuery(function(c){c("input.autocomplete").each(function(){var a=c(this);a.autocomplete(a.attr("data-autocomplete-url"))});c("html").mouseover(function(){gainedFocus()});c("a[data-remote=true]").live("ajax:success",function(a,d){showEdit(d,this.getAttribute("message"))});c(".edit_post").live("ajax:success",function(a,d){var b=c(this).attr("id");c("#"+b).hide().html(d).show("slow")});c(".bubble p, .bubble ul").live("click",function(a){if(!c(a.target).is("a")){a=c(this).parent().get(0).getAttribute("data_user");
insertQuote(c(this).text(),a)}})});function insertQuote(c,a){$("#post_body").val($("#post_body").val()+"bq..:"+a+" "+c+" \n\np. ")}function updatePosts(c){$.get(c,function(a){if(a){$(a).hide().appendTo("#posts").show("slow");lostFocus();blinkTitle(1);document.getElementById("player").play()}},"js")}function showPost(c,a){$.get(c,function(d){if(d){$(d).hide().appendTo("#posts").show("slow");a!=user_id&&notify()}},"js")}function showEdit(c,a){$("#"+a).find("div").hide().html(c).show("slow")}
function notify(){lostFocus();blinkTitle(1);audioNotification()}function blinkTitle(c){if(windowIsActive!=true){if(c==1){document.title="[new!] - "+titleHolder;c=0}else{document.title=""+titleHolder;c=1}setTimeout("blinkTitle("+c+")",1600)}else document.title=titleHolder}function audioNotification(){document.getElementById("player").play()}function lostFocus(){windowIsActive=false}function gainedFocus(){windowIsActive=true};
