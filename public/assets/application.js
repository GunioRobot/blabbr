(function(b){b.Autocompleter=function(e,d){this.cacheData_={};this.cacheLength_=0;this.selectClass_="jquery-autocomplete-selected-item";this.lastSelectedValue_=this.lastProcessedValue_=this.lastKeyPressed_=this.keyTimeout_=null;this.active_=false;this.finishOnBlur_=true;if(!e||!(e instanceof jQuery)||e.length!==1||e.get(0).tagName.toUpperCase()!=="INPUT")alert("Invalid parameter for jquery.Autocompleter, jQuery object with one element with INPUT tag expected");else{this.options=typeof d==="string"?
{url:d}:d;this.options.maxCacheLength=parseInt(this.options.maxCacheLength);if(isNaN(this.options.maxCacheLength)||this.options.maxCacheLength<1)this.options.maxCacheLength=1;this.options.minChars=parseInt(this.options.minChars);if(isNaN(this.options.minChars)||this.options.minChars<1)this.options.minChars=1;this.dom={};this.dom.$elem=e;this.options.inputClass&&this.dom.$elem.addClass(this.options.inputClass);this.dom.$results=b("<div></div>").hide();this.options.resultsClass&&this.dom.$results.addClass(this.options.resultsClass);
this.dom.$results.css({position:"absolute"});b("body").append(this.dom.$results);var f=this;this.position();b(window).resize(function(){f.position()});e.keydown(function(j){f.lastKeyPressed_=j.keyCode;switch(f.lastKeyPressed_){case 38:j.preventDefault();f.active_?f.focusPrev():f.activate();return false;case 40:j.preventDefault();f.active_?f.focusNext():f.activate();return false;case 9:case 13:if(f.active_){j.preventDefault();f.selectCurrent();return false}break;case 27:if(f.active_){j.preventDefault();
f.finish();return false}break;default:f.activate()}});e.blur(function(){f.finishOnBlur_&&setTimeout(function(){f.finish()},200)})}};b.Autocompleter.prototype.position=function(){var e=this.dom.$elem.offset();this.dom.$results.css({top:e.top+this.dom.$elem.outerHeight(),left:e.left})};b.Autocompleter.prototype.cacheRead=function(e){var d,f,j,l,h;if(this.options.useCache){e=String(e);d=e.length;for(f=this.options.matchSubset?1:d;f<=d;){l=this.options.matchInside?d-f:0;for(h=0;h<=l;){j=e.substr(0,f);
if(this.cacheData_[j]!==undefined)return this.cacheData_[j];h++}f++}}return false};b.Autocompleter.prototype.cacheWrite=function(e,d){if(this.options.useCache){this.cacheLength_>=this.options.maxCacheLength&&this.cacheFlush();e=String(e);this.cacheData_[e]!==undefined&&this.cacheLength_++;return this.cacheData_[e]=d}return false};b.Autocompleter.prototype.cacheFlush=function(){this.cacheData_={};this.cacheLength_=0};b.Autocompleter.prototype.callHook=function(e,d){var f=this.options[e];if(f&&b.isFunction(f))return f(d,
this);return false};b.Autocompleter.prototype.activate=function(){var e=this,d=parseInt(this.options.delay);if(isNaN(d)||d<=0)d=250;this.keyTimeout_&&clearTimeout(this.keyTimeout_);this.keyTimeout_=setTimeout(function(){e.activateNow()},d)};b.Autocompleter.prototype.activateNow=function(){var e=this.dom.$elem.val();if(e!==this.lastProcessedValue_&&e!==this.lastSelectedValue_)if(e.length>=this.options.minChars){this.active_=true;this.lastProcessedValue_=e;this.fetchData(e)}};b.Autocompleter.prototype.fetchData=
function(e){if(this.options.data)this.filterAndShowResults(this.options.data,e);else{var d=this;this.fetchRemoteData(e,function(f){d.filterAndShowResults(f,e)})}};b.Autocompleter.prototype.fetchRemoteData=function(e,d){var f=this.cacheRead(e);if(f)d(f);else try{var j=this;this.dom.$elem.addClass(this.options.loadingClass);b.get(this.makeUrl(e),function(h){h=j.parseRemoteData(h);j.cacheWrite(e,h);j.dom.$elem.removeClass(j.options.loadingClass);d(h)})}catch(l){this.dom.$elem.removeClass(this.options.loadingClass);
d(false)}};b.Autocompleter.prototype.setExtraParam=function(e,d){var f=b.trim(String(e));if(f){if(!this.options.extraParams)this.options.extraParams={};if(this.options.extraParams[f]!==d){this.options.extraParams[f]=d;this.cacheFlush()}}};b.Autocompleter.prototype.makeUrl=function(e){var d=this,f=this.options.paramName||"q",j=this.options.url,l=b.extend({},this.options.extraParams),h=[];l[f]=e;b.each(l,function(m,p){h.push(d.makeUrlParam(m,p))});j+=j.indexOf("?")==-1?"?":"&";j+=h.join("&");return j};
b.Autocompleter.prototype.makeUrlParam=function(e,d){return String(e)+"="+encodeURIComponent(d)};b.Autocompleter.prototype.parseRemoteData=function(e){var d=[],f,j,l,h=String(e).replace("\r\n","\n").split("\n");for(e=0;e<h.length;e++){l=h[e].split("|");j=[];for(f=0;f<l.length;f++)j.push(unescape(l[f]));f=j.shift();d.push({value:unescape(f),data:j})}return d};b.Autocompleter.prototype.filterAndShowResults=function(e,d){this.showResults(this.filterResults(e,d),d)};b.Autocompleter.prototype.filterResults=
function(e,d){var f=[],j,l,h,m,p,s="";for(h=0;h<e.length;h++){m=e[h];p=typeof m;if(p==="string"){j=m;l={}}else if(b.isArray(m)){j=m.shift();l=m}else if(p==="object"){j=m.value;l=m.data}if(j=String(j)){if(typeof l!=="object")l={};m=String(d);this.options.matchInside||(m="^"+m);this.options.matchCase||(s="i");m=new RegExp(m,s);m.test(j)&&f.push({value:j,data:l})}}if(this.options.sortResults)return this.sortResults(f);return f};b.Autocompleter.prototype.sortResults=function(e){var d=this;b.isFunction(this.options.sortFunction)?
e.sort(this.options.sortFunction):e.sort(function(f,j){return d.sortValueAlpha(f,j)});return e};b.Autocompleter.prototype.sortValueAlpha=function(e,d){e=String(e.value);d=String(d.value);if(!this.options.matchCase){e=e.toLowerCase();d=d.toLowerCase()}if(e>d)return 1;if(e<d)return-1;return 0};b.Autocompleter.prototype.showResults=function(e,d){var f=this,j=b("<ul></ul>"),l,h,m,p=false,s=false,u=e.length;for(l=0;l<u;l++){h=e[l];m=b("<li>"+this.showResult(h.value,h.data)+"</li>");m.data("value",h.value);
m.data("data",h.data);m.click(function(){var t=b(this);f.selectItem(t)}).mousedown(function(){f.finishOnBlur_=false}).mouseup(function(){f.finishOnBlur_=true});j.append(m);if(p===false){p=String(h.value);s=m;m.addClass(this.options.firstItemClass)}l==u-1&&m.addClass(this.options.lastItemClass)}this.dom.$results.html(j).show();j=this.dom.$results.outerWidth()-this.dom.$results.width();this.dom.$results.width(this.dom.$elem.outerWidth()-j);b("li",this.dom.$results).hover(function(){f.focusItem(this)},
function(){});this.autoFill(p,d)&&this.focusItem(s)};b.Autocompleter.prototype.showResult=function(e,d){return b.isFunction(this.options.showResult)?this.options.showResult(e,d):e};b.Autocompleter.prototype.autoFill=function(e,d){var f,j,l,h;if(this.options.autoFill&&this.lastKeyPressed_!=8){f=String(e).toLowerCase();j=String(d).toLowerCase();l=e.length;h=d.length;if(f.substr(0,h)===j){this.dom.$elem.val(e);this.selectRange(h,l);return true}}return false};b.Autocompleter.prototype.focusNext=function(){this.focusMove(+1)};
b.Autocompleter.prototype.focusPrev=function(){this.focusMove(-1)};b.Autocompleter.prototype.focusMove=function(e){var d,f=b("li",this.dom.$results);e=parseInt(e);for(d=0;d<f.length;d++)if(b(f[d]).hasClass(this.selectClass_)){this.focusItem(d+e);return}this.focusItem(0)};b.Autocompleter.prototype.focusItem=function(e){var d=b("li",this.dom.$results);if(d.length){d.removeClass(this.selectClass_).removeClass(this.options.selectClass);if(typeof e==="number"){e=parseInt(e);if(e<0)e=0;else if(e>=d.length)e=
d.length-1;e=b(d[e])}else e=b(e);e&&e.addClass(this.selectClass_).addClass(this.options.selectClass)}};b.Autocompleter.prototype.selectCurrent=function(){var e=b("li."+this.selectClass_,this.dom.$results);e.length==1?this.selectItem(e):this.finish()};b.Autocompleter.prototype.selectItem=function(e){var d=e.data("value");e=e.data("data");var f=this.displayValue(d,e);this.lastSelectedValue_=this.lastProcessedValue_=f;this.dom.$elem.val(f).focus();this.setCaret(f.length);this.callHook("onItemSelect",
{value:d,data:e});this.finish()};b.Autocompleter.prototype.displayValue=function(e,d){return b.isFunction(this.options.displayValue)?this.options.displayValue(e,d):e};b.Autocompleter.prototype.finish=function(){this.keyTimeout_&&clearTimeout(this.keyTimeout_);if(this.dom.$elem.val()!==this.lastSelectedValue_){this.options.mustMatch&&this.dom.$elem.val("");this.callHook("onNoMatch")}this.dom.$results.hide();this.lastProcessedValue_=this.lastKeyPressed_=null;this.active_&&this.callHook("onFinish");
this.active_=false};b.Autocompleter.prototype.selectRange=function(e,d){var f=this.dom.$elem.get(0);if(f.setSelectionRange){f.focus();f.setSelectionRange(e,d)}else if(this.createTextRange){f=this.createTextRange();f.collapse(true);f.moveEnd("character",d);f.moveStart("character",e);f.select()}};b.Autocompleter.prototype.setCaret=function(e){this.selectRange(e,e)};b.fn.autocomplete=function(e){if(typeof e==="string")e={url:e};var d=b.extend({},b.fn.autocomplete.defaults,e);return this.each(function(){var f=
b(this),j=new b.Autocompleter(f,d);f.data("autocompleter",j)})};b.fn.autocomplete.defaults={minChars:1,loadingClass:"acLoading",resultsClass:"acResults",inputClass:"acInput",selectClass:"acSelect",mustMatch:false,matchCase:false,matchInside:true,matchSubset:true,useCache:true,maxCacheLength:10,autoFill:false,sortResults:true,sortFunction:false,onItemSelect:false,onNoMatch:false}})(jQuery);
(function(b){b.gritter={};b.gritter.options={fade_in_speed:"medium",fade_out_speed:1E3,time:6E3};b.gritter.add=function(d){try{return e.add(d||{})}catch(f){var j="Gritter Error: "+f;typeof console!="undefined"&&console.error?console.error(j,d):alert(j)}};b.gritter.remove=function(d,f){e.removeSpecific(d,f||{})};b.gritter.removeAll=function(d){e.stop(d||{})};var e={fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[image]]<div class="[[class_name]]"><span class="gritter-title">[[username]]</span><p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',
_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(d){if(!d.title||!d.text)throw'You need to fill out the first 2 params: "title" and "text"';this._is_setup||this._runSetup();var f=d.title,j=d.text,l=d.image||"",h=d.sticky||false,m=d.class_name||"",p=d.time||"";this._verifyWrapper();this._item_count++;var s=this._item_count,u=this._tpl_item;b(["before_open","after_open","before_close","after_close"]).each(function(t,x){e["_"+x+"_"+s]=b.isFunction(d[x])?d[x]:function(){}});this._custom_timer=
0;if(p)this._custom_timer=p;u=this._str_replace(["[[username]]","[[text]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[f,j,l!=""?'<img src="'+l+'" class="gritter-image" />':"",this._item_count,l!=""?"gritter-with-image":"gritter-without-image",m],u);this["_before_open_"+s]();b("#gritter-notice-wrapper").append(u);f=b("#gritter-item-"+this._item_count);f.fadeIn(this.fade_in_speed,function(){e["_after_open_"+s](b(this))});h||this._setFadeTimer(f,s);b(f).bind("mouseenter mouseleave",
function(t){if(t.type=="mouseenter")h||e._restoreItemIfFading(b(this),s);else h||e._setFadeTimer(b(this),s);e._hoverState(b(this),t.type)});return s},_countRemoveWrapper:function(d,f){f.remove();this["_after_close_"+d](f);b(".gritter-item-wrapper").length==0&&b("#gritter-notice-wrapper").remove()},_fade:function(d,f,j,l){j=j||{};var h=typeof j.fade!="undefined"?j.fade:true;fade_out_speed=j.speed||this.fade_out_speed;this["_before_close_"+f](d);l&&d.unbind("mouseenter mouseleave");h?d.animate({opacity:0},
fade_out_speed,function(){d.animate({height:0},300,function(){e._countRemoveWrapper(f,d)})}):this._countRemoveWrapper(f,d)},_hoverState:function(d,f){if(f=="mouseenter"){d.addClass("hover");var j=d.find("img");j.length?j.before(this._tpl_close):d.find("span").before(this._tpl_close);d.find(".gritter-close").click(function(){var l=d.attr("id").split("-")[2];e.removeSpecific(l,{},d,true)})}else{d.removeClass("hover");d.find(".gritter-close").remove()}},removeSpecific:function(d,f,j,l){j||(j=b("#gritter-item-"+
d));this._fade(j,d,f||{},l)},_restoreItemIfFading:function(d,f){clearTimeout(this["_int_id_"+f]);d.stop().css({opacity:""})},_runSetup:function(){for(opt in b.gritter.options)this[opt]=b.gritter.options[opt];this._is_setup=1},_setFadeTimer:function(d,f){this["_int_id_"+f]=setTimeout(function(){e._fade(d,f)},this._custom_timer?this._custom_timer:this.time)},stop:function(d){var f=b.isFunction(d.before_close)?d.before_close:function(){},j=b.isFunction(d.after_close)?d.after_close:function(){};d=b("#gritter-notice-wrapper");
f(d);d.fadeOut(function(){b(this).remove();j()})},_str_replace:function(d,f,j,l){var h=0,m=0,p="",s="",u=0,t=0;d=[].concat(d);f=[].concat(f);j=j;var x=f instanceof Array,a=j instanceof Array;j=[].concat(j);if(l)this.window[l]=0;h=0;for(u=j.length;h<u;h++)if(j[h]!==""){m=0;for(t=d.length;m<t;m++){p=j[h]+"";s=x?f[m]!==undefined?f[m]:"":f[0];j[h]=p.split(d[m]).join(s);if(l&&j[h]!==p)this.window[l]+=(p.length-j[h].length)/d[m].length}}return a?j:j[0]},_verifyWrapper:function(){b("#gritter-notice-wrapper").length==
0&&b("body").append(this._tpl_wrap)}}})(jQuery);
(function(b){b.extend(b.fn,{livequery:function(e,d,f){var j=this,l;if(b.isFunction(e)){f=d;d=e;e=undefined}b.each(b.livequery.queries,function(h,m){if(j.selector==m.selector&&j.context==m.context&&e==m.type&&(!d||d.$lqguid==m.fn.$lqguid)&&(!f||f.$lqguid==m.fn2.$lqguid))return(l=m)&&false});l=l||new b.livequery(this.selector,this.context,e,d,f);l.stopped=false;l.run();return this},expire:function(e,d,f){var j=this;if(b.isFunction(e)){f=d;d=e;e=undefined}b.each(b.livequery.queries,function(l,h){if(j.selector==
h.selector&&j.context==h.context&&(!e||e==h.type)&&(!d||d.$lqguid==h.fn.$lqguid)&&(!f||f.$lqguid==h.fn2.$lqguid)&&!this.stopped)b.livequery.stop(h.id)});return this}});b.livequery=function(e,d,f,j,l){this.selector=e;this.context=d;this.type=f;this.fn=j;this.fn2=l;this.elements=[];this.stopped=false;this.id=b.livequery.queries.push(this)-1;j.$lqguid=j.$lqguid||b.livequery.guid++;if(l)l.$lqguid=l.$lqguid||b.livequery.guid++;return this};b.livequery.prototype={stop:function(){var e=this;if(this.type)this.elements.unbind(this.type,
this.fn);else this.fn2&&this.elements.each(function(d,f){e.fn2.apply(f)});this.elements=[];this.stopped=true},run:function(){if(!this.stopped){var e=this,d=this.elements,f=b(this.selector,this.context),j=f.not(d);this.elements=f;if(this.type){j.bind(this.type,this.fn);d.length>0&&b.each(d,function(l,h){b.inArray(h,f)<0&&b.event.remove(h,e.type,e.fn)})}else{j.each(function(){e.fn.apply(this)});this.fn2&&d.length>0&&b.each(d,function(l,h){b.inArray(h,f)<0&&e.fn2.apply(h)})}}}};b.extend(b.livequery,
{guid:0,queries:[],queue:[],running:false,timeout:null,checkQueue:function(){if(b.livequery.running&&b.livequery.queue.length)for(var e=b.livequery.queue.length;e--;)b.livequery.queries[b.livequery.queue.shift()].run()},pause:function(){b.livequery.running=false},play:function(){b.livequery.running=true;b.livequery.run()},registerPlugin:function(){b.each(arguments,function(e,d){if(b.fn[d]){var f=b.fn[d];b.fn[d]=function(){var j=f.apply(this,arguments);b.livequery.run();return j}}})},run:function(e){if(e!=
undefined)b.inArray(e,b.livequery.queue)<0&&b.livequery.queue.push(e);else b.each(b.livequery.queries,function(d){b.inArray(d,b.livequery.queue)<0&&b.livequery.queue.push(d)});b.livequery.timeout&&clearTimeout(b.livequery.timeout);b.livequery.timeout=setTimeout(b.livequery.checkQueue,20)},stop:function(e){e!=undefined?b.livequery.queries[e].stop():b.each(b.livequery.queries,function(d){b.livequery.queries[d].stop()})}});b.livequery.registerPlugin("append","prepend","after","before","wrap","attr",
"removeAttr","addClass","removeClass","toggleClass","empty","remove","html");b(function(){b.livequery.play()})})(jQuery);
(function(b){b.fn.sexyPost=function(e){var d=["onstart","onprogress","oncomplete","onerror","onabort","onfilestart","onfilecomplete"],f={async:true,autoclear:false,onstart:function(){},onprogress:function(){},oncomplete:function(){},onerror:function(){},onabort:function(){}};e&&b.extend(f,e);this.each(function(){function j(m,p,s,u){var t=new FormData;b("input:text, input:hidden, input:password, textarea",m).each(function(){t.append(b(this).attr("name"),b(this).val())});b("input:file",m).each(function(){var x=
this.files;for(i=0;i<x.length;i++)t.append(b(this).attr("name"),x[i])});b("select option:selected",m).each(function(){t.append(b(this).parent().attr("name"),b(this).val())});b("input:checked",m).each(function(){t.append(b(this).attr("name"),b(this).val())});h.open(s,p,u);h.setRequestHeader("Cache-Control","no-cache");h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.send(t)}for(event in d)f[d[event]]&&b(this).bind("sexyPost."+d[event],f[d[event]]);var l=b(this);l.submit(function(){var m=b(this).attr("action"),
p=b(this).attr("method");j(this,m,p,f.async);return false});b(".submit-trigger",l).not(":button").bind("change",function(){l.trigger("submit")});b(".submit-trigger",l).not(":input").bind("click",function(){l.trigger("submit")});var h=new XMLHttpRequest;h.onloadstart=function(){l.trigger("sexyPost.onstart")};h.onload=function(){f.autoclear&&h.status>=200&&h.status<=204&&b(":input",l).not(":button, :submit, :reset, :hidden").removeAttr("checked").removeAttr("selected").val("");l.trigger("sexyPost.oncomplete",
[h.responseText])};h.onerror=function(){l.trigger("sexyPost.onerror")};h.onabort=function(){l.trigger("sexyPost.onabort")};h.upload.onprogress=function(m){l.trigger("sexyPost.onprogress",[m.loaded/m.total,m.loaded,m.total])}});return this}})(jQuery);
(function(b,e){var d,f=/:([\w\d]+)/g,j=/\?([^#]*)$/,l=function(a){return Array.prototype.slice.call(a)},h=function(a){return Object.prototype.toString.call(a)==="[object Function]"},m=function(a){return Object.prototype.toString.call(a)==="[object Array]"},p=decodeURIComponent,s=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},u=function(a){return function(c,g){return this.route.apply(this,[a,c,g])}},t={},x=[];d=function(){var a=l(arguments),c,g;d.apps=d.apps||
{};if(a.length===0||a[0]&&h(a[0]))return d.apply(d,["body"].concat(a));else if(typeof(g=a.shift())=="string"){c=d.apps[g]||new d.Application;c.element_selector=g;a.length>0&&b.each(a,function(k,o){c.use(o)});c.element_selector!=g&&delete d.apps[g];return d.apps[c.element_selector]=c}};d.VERSION="0.6.2";d.addLogger=function(a){x.push(a)};d.log=function(){var a=l(arguments);a.unshift("["+Date()+"]");b.each(x,function(c,g){g.apply(d,a)})};if(typeof e.console!="undefined")h(console.log.apply)?d.addLogger(function(){e.console.log.apply(console,
arguments)}):d.addLogger(function(){e.console.log(arguments)});else typeof console!="undefined"&&d.addLogger(function(){console.log.apply(console,arguments)});b.extend(d,{makeArray:l,isFunction:h,isArray:m});d.Object=function(a){return b.extend(this,a||{})};b.extend(d.Object.prototype,{escapeHTML:s,h:s,toHash:function(){var a={};b.each(this,function(c,g){h(g)||(a[c]=g)});return a},toHTML:function(){var a="";b.each(this,function(c,g){h(g)||(a+="<strong>"+c+"</strong> "+g+"<br />")});return a},keys:function(a){var c=
[];for(var g in this)if(!h(this[g])||!a)c.push(g);return c},has:function(a){return this[a]&&b.trim(this[a].toString())!=""},join:function(){var a=l(arguments),c=a.shift();return a.join(c)},log:function(){d.log.apply(d,arguments)},toString:function(a){var c=[];b.each(this,function(g,k){if(!h(k)||a)c.push('"'+g+'": '+k.toString())});return"Sammy.Object: {"+c.join(",")+"}"}});d.HashLocationProxy=function(a,c){this.app=a;this.is_native=false;this._startPolling(c)};d.HashLocationProxy.prototype={bind:function(){var a=
this,c=this.app;b(e).bind("hashchange."+this.app.eventNamespace(),function(g,k){if(a.is_native===false&&!k){d.log("native hash change exists, using");a.is_native=true;e.clearInterval(d.HashLocationProxy._interval)}c.trigger("location-changed")});if(!d.HashLocationProxy._bindings)d.HashLocationProxy._bindings=0;d.HashLocationProxy._bindings++},unbind:function(){b(e).unbind("hashchange."+this.app.eventNamespace());d.HashLocationProxy._bindings--;d.HashLocationProxy._bindings<=0&&e.clearInterval(d.HashLocationProxy._interval)},
getLocation:function(){var a=e.location.toString().match(/^[^#]*(#.+)$/);return a?a[1]:""},setLocation:function(a){return e.location=a},_startPolling:function(a){var c=this;if(!d.HashLocationProxy._interval){a||(a=10);var g=function(){var k=c.getLocation();if(!d.HashLocationProxy._last_location||k!=d.HashLocationProxy._last_location)e.setTimeout(function(){b(e).trigger("hashchange",[true])},13);d.HashLocationProxy._last_location=k};g();d.HashLocationProxy._interval=e.setInterval(g,a)}}};d.Application=
function(a){var c=this;this.routes={};this.listeners=new d.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1E3,10);this.context_prototype=function(){d.EventContext.apply(this,arguments)};this.context_prototype.prototype=new d.EventContext;h(a)&&a.apply(this,[this]);this._location_proxy||this.setLocationProxy(new d.HashLocationProxy(this,this.run_interval_every));this.debug&&this.bindToAllEvents(function(g,k){c.log(c.toString(),g.cleaned_type,
k||{})})};d.Application.prototype=b.extend({},d.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:false,element_selector:"body",debug:false,raise_errors:false,run_interval_every:50,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},
$element:function(){return b(this.element_selector)},use:function(){var a=l(arguments),c=a.shift(),g=c||"";try{a.unshift(this);if(typeof c=="string"){g="Sammy."+c;c=d[c]}c.apply(this,a)}catch(k){if(typeof c==="undefined")this.error("Plugin Error: called use() but plugin ("+g.toString()+") is not defined",k);else h(c)?this.error("Plugin Error",k):this.error("Plugin Error: called use() but '"+g.toString()+"' is not a function",k)}return this},setLocationProxy:function(a){var c=this._location_proxy;
this._location_proxy=a;if(this.isRunning()){c&&c.unbind();this._location_proxy.bind()}},route:function(a,c,g){var k=this,o=[],n,q;if(!g&&h(c)){g=c=a;a="any"}a=a.toLowerCase();if(c.constructor==String){for(f.lastIndex=0;(q=f.exec(c))!==null;)o.push(q[1]);c=new RegExp("^"+c.replace(f,"([^/]+)")+"$")}if(typeof g=="string")g=k[g];n=function(r){var v={verb:r,path:c,callback:g,param_names:o};k.routes[r]=k.routes[r]||[];k.routes[r].push(v)};a==="any"?b.each(this.ROUTE_VERBS,function(r,v){n(v)}):n(a);return this},
get:u("get"),post:u("post"),put:u("put"),del:u("delete"),any:u("any"),mapRoutes:function(a){var c=this;b.each(a,function(g,k){c.route.apply(c,k)});return this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(a,c,g){var k=this;if(typeof g=="undefined")g=c;c=function(o,n){var q;if(n&&n.context){q=n.context;delete n.context}else q=new k.context_prototype(k,"bind",o.type,n,o.target);o.cleaned_type=o.type.replace(k.eventNamespace(),"");g.apply(q,[o,n])};this.listeners[a]||
(this.listeners[a]=[]);this.listeners[a].push(c);this.isRunning()&&this._listen(a,c);return this},trigger:function(a,c){this.$element().trigger([a,this.eventNamespace()].join("."),[c]);return this},refresh:function(){this.last_location=null;this.trigger("location-changed");return this},before:function(a,c){if(h(a)){c=a;a={}}this.befores.push([a,c]);return this},after:function(a){return this.bind("event-context-after",a)},around:function(a){this.arounds.push(a);return this},isRunning:function(){return this._running},
helpers:function(a){b.extend(this.context_prototype.prototype,a);return this},helper:function(a,c){this.context_prototype.prototype[a]=c;return this},run:function(a){if(this.isRunning())return false;var c=this;b.each(this.listeners.toHash(),function(g,k){b.each(k,function(o,n){c._listen(g,n)})});this.trigger("run",{start_url:a});this._running=true;this.last_location=null;this.getLocation()==""&&typeof a!="undefined"&&this.setLocation(a);this._checkLocation();this._location_proxy.bind();this.bind("location-changed",
function(){c._checkLocation()});this.bind("submit",function(g){return c._checkFormSubmission(b(g.target).closest("form"))===false?g.preventDefault():false});b(e).bind("beforeunload",function(){c.unload()});return this.trigger("changed")},unload:function(){if(!this.isRunning())return false;var a=this;this.trigger("unload");this._location_proxy.unbind();this.$element().unbind("submit").removeClass(a.eventNamespace());b.each(this.listeners.toHash(),function(c,g){b.each(g,function(k,o){a._unlisten(c,
o)})});this._running=false;return this},bindToAllEvents:function(a){var c=this;b.each(this.APP_EVENTS,function(g,k){c.bind(k,a)});b.each(this.listeners.keys(true),function(g,k){c.APP_EVENTS.indexOf(k)==-1&&c.bind(k,a)});return this},routablePath:function(a){return a.replace(j,"")},lookupRoute:function(a,c){var g=this,k=false;this.trigger("lookup-route",{verb:a,path:c});typeof this.routes[a]!="undefined"&&b.each(this.routes[a],function(o,n){if(g.routablePath(c).match(n.path)){k=n;return false}});return k},
runRoute:function(a,c,g,k){var o=this,n=this.lookupRoute(a,c),q,r,v,w,B,A,C;this.log("runRoute",[a,c].join(" "));this.trigger("run-route",{verb:a,path:c,params:g});if(typeof g=="undefined")g={};b.extend(g,this._parseQueryString(c));if(n){this.trigger("route-found",{route:n});if((A=n.path.exec(this.routablePath(c)))!==null){A.shift();b.each(A,function(y,z){if(n.param_names[y])g[n.param_names[y]]=p(z);else{if(!g.splat)g.splat=[];g.splat.push(p(z))}})}q=new this.context_prototype(this,a,c,g,k);k=this.arounds.slice(0);
v=this.befores.slice(0);B=[q].concat(g.splat);r=function(){for(var y;v.length>0;){w=v.shift();if(o.contextMatchesOptions(q,w[0])){y=w[1].apply(q,[q]);if(y===false)return false}}o.last_route=n;q.trigger("event-context-before",{context:q});y=n.callback.apply(q,B);q.trigger("event-context-after",{context:q});return y};b.each(k.reverse(),function(y,z){var D=r;r=function(){return z.apply(q,[D])}});try{C=r()}catch(E){this.error(["500 Error",a,c].join(" "),E)}return C}else return this.notFound(a,c)},contextMatchesOptions:function(a,
c,g){c=c;if(typeof c==="undefined"||c=={})return true;if(typeof g==="undefined")g=true;if(typeof c==="string"||h(c.test))c={path:c};if(c.only)return this.contextMatchesOptions(a,c.only,true);else if(c.except)return this.contextMatchesOptions(a,c.except,false);var k=true,o=true;if(c.path)k=h(c.path.test)?c.path.test(a.path):c.path.toString()===a.path;if(c.verb)o=c.verb===a.verb;return g?o&&k:!(o&&k)},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(a){return this._location_proxy.setLocation(a)},
swap:function(a){return this.$element().html(a)},templateCache:function(a,c){return typeof c!="undefined"?(t[a]=c):t[a]},clearTemplateCache:function(){return t={}},notFound:function(a,c){var g=this.error(["404 Not Found",a,c].join(" "));return a==="get"?g:true},error:function(a,c){c||(c=new Error);c.message=[a,c.message].join(" ");this.trigger("error",{message:c.message,error:c});if(this.raise_errors)throw c;else this.log(c.message,c)},_checkLocation:function(){var a,c;a=this.getLocation();if(!this.last_location||
this.last_location[0]!="get"||this.last_location[1]!=a){this.last_location=["get",a];c=this.runRoute("get",a)}return c},_getFormVerb:function(a){a=b(a);var c,g;g=a.find('input[name="_method"]');if(g.length>0)c=g.val();c||(c=a[0].getAttribute("method"));return b.trim(c.toString().toLowerCase())},_checkFormSubmission:function(a){var c,g,k;this.trigger("check-form-submission",{form:a});c=b(a);g=c.attr("action");k=this._getFormVerb(c);if(!k||k=="")k="get";this.log("_checkFormSubmission",c,g,k);if(k===
"get"){this.setLocation(g+"?"+c.serialize());a=false}else{c=b.extend({},this._parseFormParams(c));a=this.runRoute(k,g,c,a.get(0))}return typeof a=="undefined"?false:a},_parseFormParams:function(a){var c={};a=a.serializeArray();var g;for(g=0;g<a.length;g++)c=this._parseParamPair(c,a[g].name,a[g].value);return c},_parseQueryString:function(a){var c={},g,k;if(a=a.match(j)){a=a[1].split("&");for(k=0;k<a.length;k++){g=a[k].split("=");c=this._parseParamPair(c,p(g[0]),p(g[1]))}}return c},_parseParamPair:function(a,
c,g){if(a[c])if(m(a[c]))a[c].push(g);else a[c]=[a[c],g];else a[c]=g;return a},_listen:function(a,c){return this.$element().bind([a,this.eventNamespace()].join("."),c)},_unlisten:function(a,c){return this.$element().unbind([a,this.eventNamespace()].join("."),c)}});d.RenderContext=function(a){this.event_context=a;this.callbacks=[];this.content=this.previous_content=null;this.waiting=this.next_engine=false};b.extend(d.RenderContext.prototype,{then:function(a){if(!h(a))if(typeof a==="string"&&a in this.event_context){var c=
this.event_context[a];a=function(k){return c.apply(this.event_context,[k])}}else return this;var g=this;if(this.waiting)this.callbacks.push(a);else{this.wait();e.setTimeout(function(){var k=a.apply(g,[g.content,g.previous_content]);k!==false&&g.next(k)},13)}return this},wait:function(){this.waiting=true},next:function(a){this.waiting=false;if(typeof a!=="undefined"){this.previous_content=this.content;this.content=a}this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(a,c,g){var k=
this;return this.then(function(){var o,n,q;if(h(c)){g=c;c={}}else c=b.extend({},c);g&&this.then(g);if(typeof a==="string"){o=(q=a.match(/\.json$/)||c.json)&&c.cache===true||c.cache!==false;k.next_engine=k.event_context.engineFor(a);delete c.cache;delete c.json;if(c.engine){k.next_engine=c.engine;delete c.engine}if(o&&(n=this.event_context.app.templateCache(a)))return n;this.wait();b.ajax(b.extend({url:a,data:{},dataType:q?"json":null,type:"get",success:function(r){o&&k.event_context.app.templateCache(a,
r);k.next(r)}},c));return false}else{if(a.nodeType)return a.innerHTML;if(a.selector){k.next_engine=a.attr("data-engine");return c.clone===false?a.remove()[0].innerHTML.toString():a[0].innerHTML.toString()}}})},render:function(a,c,g){if(h(a)&&!c)return this.then(a);else{if(!c&&this.content)c=this.content;return this.load(a).interpolate(c,a).then(g)}},partial:function(a,c){return this.render(a,c).swap()},send:function(){var a=this,c=l(arguments),g=c.shift();if(m(c[0]))c=c[0];return this.then(function(){c.push(function(k){a.next(k)});
a.wait();g.apply(g,c);return false})},collect:function(a,c,g){var k=this,o=function(){if(h(a)){c=a;a=this.content}var n=[],q=false;b.each(a,function(r,v){var w=c.apply(k,[r,v]);if(w.jquery&&w.length==1){w=w[0];q=true}n.push(w);return w});return q?n:n.join("")};return g?o():this.then(o)},renderEach:function(a,c,g,k){if(m(c)){k=g;g=c;c=null}return this.load(a).then(function(o){var n=this;g||(g=m(this.previous_content)?this.previous_content:[]);if(k)b.each(g,function(q,r){var v={},w=this.next_engine||
a;c?(v[c]=r):(v=r);k(r,n.event_context.interpolate(o,v,w))});else return this.collect(g,function(q,r){var v={},w=this.next_engine||a;c?(v[c]=r):(v=r);return this.event_context.interpolate(o,v,w)},true)})},interpolate:function(a,c,g){var k=this;return this.then(function(o,n){if(!a&&n)a=n;if(this.next_engine){c=this.next_engine;this.next_engine=false}var q=k.event_context.interpolate(o,a,c);return g?n+q:q})},swap:function(){return this.then(function(a){this.event_context.swap(a)}).trigger("changed",
{})},appendTo:function(a){return this.then(function(c){b(a).append(c)}).trigger("changed",{})},prependTo:function(a){return this.then(function(c){b(a).prepend(c)}).trigger("changed",{})},replace:function(a){return this.then(function(c){b(a).html(c)}).trigger("changed",{})},trigger:function(a,c){return this.then(function(g){if(typeof c=="undefined")c={content:g};this.event_context.trigger(a,c)})}});d.EventContext=function(a,c,g,k,o){this.app=a;this.verb=c;this.path=g;this.params=new d.Object(k);this.target=
o};d.EventContext.prototype=b.extend({},d.Object.prototype,{$element:function(){return this.app.$element()},engineFor:function(a){var c;if(h(a))return a;a=a.toString();if(c=a.match(/\.([^\.]+)$/))a=c[1];if(a&&h(this[a]))return this[a];if(this.app.template_engine)return this.engineFor(this.app.template_engine);return function(g){return g}},interpolate:function(a,c,g){return this.engineFor(g).apply(this,[a,c])},render:function(a,c,g){return(new d.RenderContext(this)).render(a,c,g)},renderEach:function(a,
c,g,k){return(new d.RenderContext(this)).renderEach(a,c,g,k)},load:function(a,c,g){return(new d.RenderContext(this)).load(a,c,g)},partial:function(a,c){return(new d.RenderContext(this)).partial(a,c)},send:function(){var a=new d.RenderContext(this);return a.send.apply(a,arguments)},redirect:function(){var a;a=l(arguments);var c=this.app.getLocation();if(a.length>1){a.unshift("/");a=this.join.apply(this,a)}else a=a[0];this.trigger("redirect",{to:a});this.app.last_location=[this.verb,this.path];this.app.setLocation(a);
c==a&&this.app.trigger("location-changed")},trigger:function(a,c){if(typeof c=="undefined")c={};if(!c.context)c.context=this;return this.app.trigger(a,c)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(a){return this.app.swap(a)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(a){return b.parseJSON(a)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}});b.sammy=e.Sammy=d})(jQuery,window);
(function(b){function e(h){b.get(h,function(m){m&&showContent(m)})}function d(h,m){b.ajax({type:"POST",url:h,data:b.param(m.toHash()),success:function(p){showContent(p)}})}function f(h,m){b.ajax({type:"POST",url:h,data:b.param(m.toHash()),success:function(p){replaceContent(p,m.post_id)}})}function j(h,m){b.ajax({type:"POST",url:h,data:b.param(m.toHash()),success:function(p){addContent(p)}})}var l=b.sammy("#contents",function(){this.before(function(){path=ajaxPath(this.path);loadingNotification()});
this.get("#/",function(){e(path)});this.get("#/topics/new",function(){e(path)});this.post("/topics",function(){d(path,this.params)});this.get("#/topics/page/:page_id",function(){e(path)});this.get("#/topics/:id",function(){e(path)});this.post("/topics/:id/posts",function(){j(path,this.params)});this.post("/topics/:id/members",function(){j(path,this.params)});this.get("#/topics/:id/page/:page_id",function(){e(path)});this.get("#/topics/:id/page/:page_id/:anchor",function(){params=this.params;e("/topics/"+
params.id+"/page/"+params.page_id+".js");goToByScroll(params.anchor)});this.get("#/topics/:id/posts/:post_id/edit",function(){var h=this.params.post_id;b.get(path,function(m){m&&showEdit(m,h)})});this.put("/topics/:id/posts/:post_id",function(){f(path,this.params)});this.get("#/users/:id",function(){e(path)});this.get("#/dashboard",function(){e(path)});this.get("#/smilies",function(){e(path)});this.get("#/smilies/new",function(){e(path)})});b(function(){l.run("#/")})})(jQuery);var titleHolder=document.title;
jQuery(function(b){b("input.autocomplete").livequery(function(){b(this).each(function(){var e=b(this);e.autocomplete(e.attr("data-autocomplete-url"))})});b("#new_smiley").livequery(function(){b(this).sexyPost({onprogress:function(e,d){b("#status").text("Uploading: "+(d*100).toFixed(2)+"% complete...")},oncomplete:function(){b("#status").text("Upload complete.")}})});b("html").mouseover(function(){gainedFocus()});b("a[href^=/][class!='no-ajax']").livequery(function(){var e=b(this).attr("href");if(e.substr(-3)==
".js")e=e.substring(0,e.length-3);b(this).attr("href","#"+e.replace("#","/"))});b(".bubble p, .bubble ul").live("click",function(e){if(b(e.target).is("p, ul")){e=b(this).parent().get(0).getAttribute("data_user");insertQuote(b(this).text(),e)}})});function insertQuote(b,e){$("#post_body").val($("#post_body").val()+"bq..:"+e+" "+b+" \n\np. ")}
function updatePosts(b){$.get(b,function(e){if(e){$(e).hide().appendTo("#posts").show("slow");lostFocus();blinkTitle(1);document.getElementById("player").play()}},"js")}function ajaxPath(b){return b.substr(1)+".js"}function showPost(b,e){$.get(b,function(d){if(d){$(d).hide().appendTo("#posts").show("slow");e!=user_id&&notify();hideLoadingNotification()}},"js")}function showEdit(b,e){$("#"+e).find("div").html(b);hideLoadingNotification()}
function showContent(b){$("#contents").html(b);hideLoadingNotification()}function replaceContent(b,e){$("#"+e+" .bubble").html(b);hideLoadingNotification()}function addContent(b){$("#contents").append(b);hideLoadingNotification()}function notify(){lostFocus();blinkTitle(1);audioNotification()}
function blinkTitle(b){if(windowIsActive!=true){if(b==1){document.title="[new!] - "+titleHolder;b=0}else{document.title=""+titleHolder;b=1}setTimeout("blinkTitle("+b+")",1600)}else document.title=titleHolder}function audioNotification(){document.getElementById("player").play()}function lostFocus(){windowIsActive=false}function gainedFocus(){windowIsActive=true}function loadingNotification(){$("#contents").append('<p class="loading"></p>')}function hideLoadingNotification(){$(".loading").hide()}
function goToByScroll(b){$("#"+b).livequery(function(){$(this).addClass("anchor");$("html,body").animate({scrollTop:$(this).offset().top},"slow");$("#"+b).livequery().expire()})};
